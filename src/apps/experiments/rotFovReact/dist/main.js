/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={773:(t,e,n)=>{"use strict";const i=n(222),r=n(198),o=n(653),s=n(934),l=n(835),a=n(312);e.V0=(t,e)=>{const n=t.map((t=>{const n=l.calculateVisibility(new s.Lightsource(new s.Point(t.x,t.y),10),o.loadMap(e,{x:t.x,y:t.y}));return{x:t.x,y:t.y,triangles:n,polygon:a.default(n)}}));let i,c=n.map((t=>t.polygon));if(c.length){i=c[0];for(var h=1;h<c.length;h++)i=r.union(i,c[h])}return{markers:n,union:i&&r.segments(i).segments}},e.nZ=i.createSelector([t=>t.markers,t=>t.preloadedMap],e.V0)},312:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=t=>{const e=[];for(let n=0;n<t.length;n++){const i=t[n];e.push([i.first.x,i.first.y]),e.push([i.second.x,i.second.y])}return{inverted:!1,regions:[e]}}},616:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(934);class r extends i.Point{constructor(t,e){super(t,e),this.x=t,this.y=e}}e.EndPoint=r},959:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.endpointCompare=function(t,e){return t.angle>e.angle?1:t.angle<e.angle?-1:!t.beginsSegment&&e.beginsSegment?1:t.beginsSegment&&!e.beginsSegment?-1:0}},974:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(934);e.lineIntersection=function(t,e,n,r){const o=((r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x))/((r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y)),s=isNaN(o)?0:o,l=t.x+s*(e.x-t.x),a=t.y+s*(e.y-t.y);return new i.Point(l,a)}},653:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(350),r=(t,e)=>{const{x:n,y:i}=t,r=.5*(e.p1.x+e.p2.x)-n,o=.5*(e.p1.y+e.p2.y)-i;e.d=r*r+o*o,e.p1.angle=Math.atan2(e.p1.y-i,e.p1.x-n),e.p2.angle=Math.atan2(e.p2.y-i,e.p2.x-n)},o=2*Math.PI,s=t=>{let e=t.p2.angle-t.p1.angle;e<=-Math.PI&&(e+=o),e>Math.PI&&(e-=o),t.p1.beginsSegment=e>0,t.p2.beginsSegment=!t.p1.beginsSegment};e.preLoadMap=function(t,e,n){const r=n.regions.reduce(((t,e)=>t.concat(e.map(((t,e,n)=>{if(e>0)return new i.Segment(t[0],t[1],n[e-1][0],n[e-1][1],{x:0,y:0,wallType:"idk"})})).concat(new i.Segment(e[0][0],e[0][1],e[e.length-1][0],e[e.length-1][1],{x:99,y:98,wallType:"idk"})))),[]).filter((t=>t)),o=[];for(const e of t.getCornerSegments())o.push(e);for(const t of e)for(const e of t.getCornerSegments())o.push(e);for(const t of r)o.push(t);return o},e.loadMap=function(t,e){const n=[];for(const i of((t,e)=>{for(const n of e)r(t,n),s(n);return e})(e,t))n.push(i.p1,i.p2);return n}},934:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Lightsource=class{constructor(t,e){this.position=t,this.range=e}};e.Wall=class{constructor(t,e,n){this.x=t,this.y=e,this.wallType=n}};e.Point=class{constructor(t,e){this.x=t,this.y=e}};e.VizTriangle=class{constructor(t,e,n){this.first=t,this.second=e,this.wall=n}}},713:(t,e,n)=>{"use strict";const i=n(934),r=n(350);e.A=class{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}getCorners(){return{nw:new i.Point(this.x,this.y),sw:new i.Point(this.x,this.y+this.height),ne:new i.Point(this.x+this.width,this.y),se:new i.Point(this.x+this.width,this.y+this.height)}}getCornerSegments(){const{nw:t,sw:e,ne:n,se:i}=this.getCorners();return[new r.Segment(t.x,t.y,n.x,n.y,{x:0,y:0,wallType:"idk"}),new r.Segment(t.x,t.y,e.x,e.y,{x:0,y:0,wallType:"idk"}),new r.Segment(n.x,n.y,i.x,i.y,{x:0,y:0,wallType:"idk"}),new r.Segment(e.x,e.y,i.x,i.y,{x:0,y:0,wallType:"idk"})]}}},570:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(934),r=(t,e)=>(t.p2.x-t.p1.x)*(e.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.x-t.p1.x)<0,o=(t,e,n)=>{const r=1-n;return new i.Point(t.x*r+e.x*n,t.y*r+e.y*n)};e.segmentInFrontOf=(t,e,n)=>{const i=r(t,o(e.p1,e.p2,.01)),s=r(t,o(e.p2,e.p1,.01)),l=r(t,n),a=r(e,o(t.p1,t.p2,.01)),c=r(e,o(t.p2,t.p1,.01)),h=r(e,n);return a===c&&c!==h||i===s&&s===l}},350:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(616);e.Segment=class{constructor(t,e,n,r,o){this.d=0,this.p1=new i.EndPoint(t,e),this.p2=new i.EndPoint(n,r),this.p1.segment=this,this.p2.segment=this,this.wall=o}}},835:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(974),r=n(959),o=n(570),s=n(934),l=t=>Math.sin(t),a=t=>Math.cos(t);function c(t,e,n,r){const o=a(e),c=l(e),h=a(n),u=l(n),f=t,p=new s.Point(t.x+o,t.y+c),d=new s.Point(0,0),g=new s.Point(0,0);r?(d.x=r.p1.x,d.y=r.p1.y,g.x=r.p2.x,g.y=r.p2.y):(d.x=t.x+200*o,d.y=t.y+200*c,g.x=t.x+200*h,g.y=t.y+200*u);const m=i.lineIntersection(d,g,f,p);p.x=t.x+h,p.y=t.y+u;const _=i.lineIntersection(d,g,f,p);return r?{first:m,second:_,wall:r.wall}:{first:m,second:_,wall:{x:0,y:0,wallType:"idk"}}}e.calculateVisibility=function(t,e){const n=t.position,i=[],s=[];let l=0;e.sort(r.endpointCompare);for(let t=0;t<2;t+=1)for(const r of e){const e=i[0];if(r.beginsSegment){let t=0,e=i[t];for(;e&&o.segmentInFrontOf(r.segment,e,n);)t+=1,e=i[t];e?i.splice(t,0,r.segment):i.push(r.segment)}else{const t=i.indexOf(r.segment);t>-1&&i.splice(t,1)}if(e!==i[0]){if(1===t){const t=c(n,l,r.angle,e);s.push(t)}l=r.angle}}return s}},895:t=>{t.exports=function(t,e,n,i){var r=t[0],o=t[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var l=(i-n)/2,a=0,c=l-1;a<l;c=a++){var h=e[n+2*a+0],u=e[n+2*a+1],f=e[n+2*c+0],p=e[n+2*c+1];u>o!=p>o&&r<(f-h)*(o-u)/(p-u)+h&&(s=!s)}return s}},960:(t,e,n)=>{var i=n(895),r=n(139);t.exports=function(t,e,n,o){return e.length>0&&Array.isArray(e[0])?r(t,e,n,o):i(t,e,n,o)},t.exports.nested=r,t.exports.flat=i},139:t=>{t.exports=function(t,e,n,i){var r=t[0],o=t[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var l=i-n,a=0,c=l-1;a<l;c=a++){var h=e[a+n][0],u=e[a+n][1],f=e[c+n][0],p=e[c+n][1];u>o!=p>o&&r<(f-h)*(o-u)/(p-u)+h&&(s=!s)}return s}},198:(t,e,n)=>{var i,r=n(919),o=n(26),s=n(624),l=n(759),a=n(557),c=n(485),h=!1,u=o();function f(t,e,n){var r=i.segments(t),o=i.segments(e),s=n(i.combine(r,o));return i.polygon(s)}i={buildLog:function(t){return!0===t?h=r():!1===t&&(h=!1),!1!==h&&h.list},epsilon:function(t){return u.epsilon(t)},segments:function(t){var e=s(!0,u,h);return t.regions.forEach(e.addRegion),{segments:e.calculate(t.inverted),inverted:t.inverted}},combine:function(t,e){return{combined:s(!1,u,h).calculate(t.segments,t.inverted,e.segments,e.inverted),inverted1:t.inverted,inverted2:e.inverted}},selectUnion:function(t){return{segments:a.union(t.combined,h),inverted:t.inverted1||t.inverted2}},selectIntersect:function(t){return{segments:a.intersect(t.combined,h),inverted:t.inverted1&&t.inverted2}},selectDifference:function(t){return{segments:a.difference(t.combined,h),inverted:t.inverted1&&!t.inverted2}},selectDifferenceRev:function(t){return{segments:a.differenceRev(t.combined,h),inverted:!t.inverted1&&t.inverted2}},selectXor:function(t){return{segments:a.xor(t.combined,h),inverted:t.inverted1!==t.inverted2}},polygon:function(t){return{regions:l(t.segments,u,h),inverted:t.inverted}},polygonFromGeoJSON:function(t){return c.toPolygon(i,t)},polygonToGeoJSON:function(t){return c.fromPolygon(i,u,t)},union:function(t,e){return f(t,e,i.selectUnion)},intersect:function(t,e){return f(t,e,i.selectIntersect)},difference:function(t,e){return f(t,e,i.selectDifference)},differenceRev:function(t,e){return f(t,e,i.selectDifferenceRev)},xor:function(t,e){return f(t,e,i.selectXor)}},"object"==typeof window&&(window.PolyBool=i),t.exports=i},919:t=>{t.exports=function(){var t,e=0,n=!1;function i(e,n){return t.list.push({type:e,data:n?JSON.parse(JSON.stringify(n)):void 0}),t}return t={list:[],segmentId:function(){return e++},checkIntersection:function(t,e){return i("check",{seg1:t,seg2:e})},segmentChop:function(t,e){return i("div_seg",{seg:t,pt:e}),i("chop",{seg:t,pt:e})},statusRemove:function(t){return i("pop_seg",{seg:t})},segmentUpdate:function(t){return i("seg_update",{seg:t})},segmentNew:function(t,e){return i("new_seg",{seg:t,primary:e})},segmentRemove:function(t){return i("rem_seg",{seg:t})},tempStatus:function(t,e,n){return i("temp_status",{seg:t,above:e,below:n})},rewind:function(t){return i("rewind",{seg:t})},status:function(t,e,n){return i("status",{seg:t,above:e,below:n})},vert:function(e){return e===n?t:(n=e,i("vert",{x:e}))},log:function(t){return"string"!=typeof t&&(t=JSON.stringify(t,!1,"  ")),i("log",{txt:t})},reset:function(){return i("reset")},selected:function(t){return i("selected",{segs:t})},chainStart:function(t){return i("chain_start",{seg:t})},chainRemoveHead:function(t,e){return i("chain_rem_head",{index:t,pt:e})},chainRemoveTail:function(t,e){return i("chain_rem_tail",{index:t,pt:e})},chainNew:function(t,e){return i("chain_new",{pt1:t,pt2:e})},chainMatch:function(t){return i("chain_match",{index:t})},chainClose:function(t){return i("chain_close",{index:t})},chainAddHead:function(t,e){return i("chain_add_head",{index:t,pt:e})},chainAddTail:function(t,e){return i("chain_add_tail",{index:t,pt:e})},chainConnect:function(t,e){return i("chain_con",{index1:t,index2:e})},chainReverse:function(t){return i("chain_rev",{index:t})},chainJoin:function(t,e){return i("chain_join",{index1:t,index2:e})},done:function(){return i("done")}}}},26:t=>{const e=Math.abs;t.exports=function(t){"number"!=typeof t&&(t=1e-10);var n={epsilon:function(e){return"number"==typeof e&&(t=e),t},pointAboveOrOnLine:function(e,n,i){var r=n[0],o=n[1],s=i[0],l=i[1],a=e[0];return(s-r)*(e[1]-o)-(l-o)*(a-r)>=-t},pointBetween:function(e,n,i){var r=e[1]-n[1],o=i[0]-n[0],s=e[0]-n[0],l=i[1]-n[1],a=s*o+r*l;return!(a<t)&&!(a-(o*o+l*l)>-t)},pointsSameX:function(n,i){return e(n[0]-i[0])<t},pointsSameY:function(n,i){return e(n[1]-i[1])<t},pointsSame:function(t,e){return n.pointsSameX(t,e)&&n.pointsSameY(t,e)},pointsCompare:function(t,e){return n.pointsSameX(t,e)?n.pointsSameY(t,e)?0:t[1]<e[1]?-1:1:t[0]<e[0]?-1:1},pointsCollinear:function(n,i,r){var o=n[0]-i[0],s=n[1]-i[1],l=i[0]-r[0],a=i[1]-r[1];return e(o*a-l*s)<t},linesIntersect:function(n,i,r,o){var s=i[0]-n[0],l=i[1]-n[1],a=o[0]-r[0],c=o[1]-r[1],h=s*c-l*a;if(e(h)<t)return!1;var u=n[0]-r[0],f=n[1]-r[1],p=(a*f-c*u)/h,d=(s*f-l*u)/h,g={alongA:0,alongB:0,pt:[n[0]+p*s,n[1]+p*l]};return g.alongA=p<=-t?-2:p<t?-1:p-1<=-t?0:p-1<t?1:2,g.alongB=d<=-t?-2:d<t?-1:d-1<=-t?0:d-1<t?1:2,g},pointInsideRegion:function(e,n){for(var i=e[0],r=e[1],o=n[n.length-1][0],s=n[n.length-1][1],l=!1,a=0;a<n.length;a++){var c=n[a][0],h=n[a][1];h-r>t!=s-r>t&&(o-c)*(r-h)/(s-h)+c-i>t&&(l=!l),o=c,s=h}return l}};return n}},485:t=>{var e={toPolygon:function(t,e){function n(e){if(e.length<=0)return t.segments({inverted:!1,regions:[]});function n(e){var n=e.slice(0,e.length-1);return t.segments({inverted:!1,regions:[n]})}for(var i=n(e[0]),r=1;r<e.length;r++)i=t.selectDifference(t.combine(i,n(e[r])));return i}if("Polygon"===e.type)return t.polygon(n(e.coordinates));if("MultiPolygon"===e.type){for(var i=t.segments({inverted:!1,regions:[]}),r=0;r<e.coordinates.length;r++)i=t.selectUnion(t.combine(i,n(e.coordinates[r])));return t.polygon(i)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(t,e,n){function i(t,n){return e.pointInsideRegion([.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])],n)}function r(t){return{region:t,children:[]}}n=t.polygon(t.segments(n));var o=r(null);function s(t,e){for(var n=0;n<t.children.length;n++){if(i(e,(l=t.children[n]).region))return void s(l,e)}var o=r(e);for(n=0;n<t.children.length;n++){var l;i((l=t.children[n]).region,e)&&(o.children.push(l),t.children.splice(n,1),n--)}t.children.push(o)}for(var l=0;l<n.regions.length;l++){var a=n.regions[l];a.length<3||s(o,a)}function c(t,e){for(var n=0,i=t[t.length-1][0],r=t[t.length-1][1],o=[],s=0;s<t.length;s++){var l=t[s][0],a=t[s][1];o.push([l,a]),n+=a*i-l*r,i=l,r=a}return n<0!==e&&o.reverse(),o.push([o[0][0],o[0][1]]),o}var h=[];function u(t){var e=[c(t.region,!1)];h.push(e);for(var n=0;n<t.children.length;n++)e.push(f(t.children[n]))}function f(t){for(var e=0;e<t.children.length;e++)u(t.children[e]);return c(t.region,!0)}for(l=0;l<o.children.length;l++)u(o.children[l]);return h.length<=0?{type:"Polygon",coordinates:[]}:1==h.length?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",coordinates:h}}};t.exports=e},624:(t,e,n)=>{var i=n(488);t.exports=function(t,e,n){function r(t,e,i){return{id:n?n.segmentId():-1,start:t,end:e,myFill:{above:i.myFill.above,below:i.myFill.below},otherFill:null}}var o=i.create();function s(t,n){o.insertBefore(t,(function(i){return function(t,n,i,r,o,s){var l=e.pointsCompare(n,o);return 0!==l?l:e.pointsSame(i,s)?0:t!==r?t?1:-1:e.pointAboveOrOnLine(i,r?o:s,r?s:o)?1:-1}(t.isStart,t.pt,n,i.isStart,i.pt,i.other.pt)<0}))}function l(t,e){var n=function(t,e){var n=i.node({isStart:!0,pt:t.start,seg:t,primary:e,other:null,status:null});return s(n,t.end),n}(t,e);return function(t,e,n){var r=i.node({isStart:!1,pt:e.end,seg:e,primary:n,other:t,status:null});t.other=r,s(r,t.pt)}(n,t,e),n}function a(t,e){var i=r(e,t.seg.end,t.seg);return function(t,e){n&&n.segmentChop(t.seg,e),t.other.remove(),t.seg.end=e,t.other.pt=e,s(t.other,t.pt)}(t,e),l(i,t.primary)}function c(r,s){var l=i.create();function c(t){return l.findTransition((function(n){var i,r,o,s,l,a;return(i=t,r=n.ev,o=i.seg.start,s=i.seg.end,l=r.seg.start,a=r.seg.end,e.pointsCollinear(o,l,a)?e.pointsCollinear(s,l,a)||e.pointAboveOrOnLine(s,l,a)?1:-1:e.pointAboveOrOnLine(o,l,a)?1:-1)>0}))}function h(t,i){var r=t.seg,o=i.seg,s=r.start,l=r.end,c=o.start,h=o.end;n&&n.checkIntersection(r,o);var u=e.linesIntersect(s,l,c,h);if(!1===u){if(!e.pointsCollinear(s,l,c))return!1;if(e.pointsSame(s,h)||e.pointsSame(l,c))return!1;var f=e.pointsSame(s,c),p=e.pointsSame(l,h);if(f&&p)return i;var d=!f&&e.pointBetween(s,c,h),g=!p&&e.pointBetween(l,c,h);if(f)return g?a(i,l):a(t,h),i;d&&(p||(g?a(i,l):a(t,h)),a(i,s))}else 0===u.alongA&&(-1===u.alongB?a(t,c):0===u.alongB?a(t,u.pt):1===u.alongB&&a(t,h)),0===u.alongB&&(-1===u.alongA?a(i,s):0===u.alongA?a(i,u.pt):1===u.alongA&&a(i,l));return!1}for(var u=[];!o.isEmpty();){var f=o.getHead();if(n&&n.vert(f.pt[0]),f.isStart){n&&n.segmentNew(f.seg,f.primary);var p=c(f),d=p.before?p.before.ev:null,g=p.after?p.after.ev:null;function m(){if(d){var t=h(f,d);if(t)return t}return!!g&&h(f,g)}n&&n.tempStatus(f.seg,!!d&&d.seg,!!g&&g.seg);var _,v=m();if(v){var y;if(t)(y=null===f.seg.myFill.below||f.seg.myFill.above!==f.seg.myFill.below)&&(v.seg.myFill.above=!v.seg.myFill.above);else v.seg.otherFill=f.seg.myFill;n&&n.segmentUpdate(v.seg),f.other.remove(),f.remove()}if(o.getHead()!==f){n&&n.rewind(f.seg);continue}if(t)y=null===f.seg.myFill.below||f.seg.myFill.above!==f.seg.myFill.below,f.seg.myFill.below=g?g.seg.myFill.above:r,f.seg.myFill.above=y?!f.seg.myFill.below:f.seg.myFill.below;else if(null===f.seg.otherFill)_=g?f.primary===g.primary?g.seg.otherFill.above:g.seg.myFill.above:f.primary?s:r,f.seg.otherFill={above:_,below:_};n&&n.status(f.seg,!!d&&d.seg,!!g&&g.seg),f.other.status=p.insert(i.node({ev:f}))}else{var b=f.status;if(null===b)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(l.exists(b.prev)&&l.exists(b.next)&&h(b.prev.ev,b.next.ev),n&&n.statusRemove(b.ev.seg),b.remove(),!f.primary){var w=f.seg.myFill;f.seg.myFill=f.seg.otherFill,f.seg.otherFill=w}u.push(f.seg)}o.getHead().remove()}return n&&n.done(),u}return t?{addRegion:function(t){for(var i,r,o,s=t[t.length-1],a=0;a<t.length;a++){i=s,s=t[a];var c=e.pointsCompare(i,s);0!==c&&l((r=c<0?i:s,o=c<0?s:i,{id:n?n.segmentId():-1,start:r,end:o,myFill:{above:null,below:null},otherFill:null}),!0)}},calculate:function(t){return c(t,!1)}}:{calculate:function(t,e,n,i){return t.forEach((function(t){l(r(t.start,t.end,t),!0)})),n.forEach((function(t){l(r(t.start,t.end,t),!1)})),c(e,i)}}}},488:t=>{t.exports={create:function(){var t={root:{root:!0,next:null},exists:function(e){return null!==e&&e!==t.root},isEmpty:function(){return null===t.root.next},getHead:function(){return t.root.next},insertBefore:function(e,n){for(var i=t.root,r=t.root.next;null!==r;){if(n(r))return e.prev=r.prev,e.next=r,r.prev.next=e,void(r.prev=e);i=r,r=r.next}i.next=e,e.prev=i,e.next=null},findTransition:function(e){for(var n=t.root,i=t.root.next;null!==i&&!e(i);)n=i,i=i.next;return{before:n===t.root?null:n,after:i,insert:function(t){return t.prev=n,t.next=i,n.next=t,null!==i&&(i.prev=t),t}}}};return t},node:function(t){return t.prev=null,t.next=null,t.remove=function(){t.prev.next=t.next,t.next&&(t.next.prev=t.prev),t.prev=null,t.next=null},t}}},759:t=>{t.exports=function(t,e,n){var i=[],r=[];return t.forEach((function(t){var o=t.start,s=t.end;if(e.pointsSame(o,s))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{n&&n.chainStart(t);for(var l={index:0,matches_head:!1,matches_pt1:!1},a={index:0,matches_head:!1,matches_pt1:!1},c=l,h=0;h<i.length;h++){var u=(m=i[h])[0],f=(m[1],m[m.length-1]);m[m.length-2];if(e.pointsSame(u,o)){if(S(h,!0,!0))break}else if(e.pointsSame(u,s)){if(S(h,!0,!1))break}else if(e.pointsSame(f,o)){if(S(h,!1,!0))break}else if(e.pointsSame(f,s)&&S(h,!1,!1))break}if(c===l)return i.push([o,s]),void(n&&n.chainNew(o,s));if(c===a){n&&n.chainMatch(l.index);var p=l.index,d=l.matches_pt1?s:o,g=l.matches_head,m=i[p],_=g?m[0]:m[m.length-1],v=g?m[1]:m[m.length-2],y=g?m[m.length-1]:m[0],b=g?m[m.length-2]:m[1];return e.pointsCollinear(v,_,d)&&(g?(n&&n.chainRemoveHead(l.index,d),m.shift()):(n&&n.chainRemoveTail(l.index,d),m.pop()),_=v),e.pointsSame(y,d)?(i.splice(p,1),e.pointsCollinear(b,y,_)&&(g?(n&&n.chainRemoveTail(l.index,_),m.pop()):(n&&n.chainRemoveHead(l.index,_),m.shift())),n&&n.chainClose(l.index),void r.push(m)):void(g?(n&&n.chainAddHead(l.index,d),m.unshift(d)):(n&&n.chainAddTail(l.index,d),m.push(d)))}var w=l.index,x=a.index;n&&n.chainConnect(w,x);var k=i[w].length<i[x].length;l.matches_head?a.matches_head?k?(C(w),P(w,x)):(C(x),P(x,w)):P(x,w):a.matches_head?P(w,x):k?(C(w),P(x,w)):(C(x),P(w,x))}function S(t,e,n){return c.index=t,c.matches_head=e,c.matches_pt1=n,c===l?(c=a,!1):(c=null,!0)}function C(t){n&&n.chainReverse(t),i[t].reverse()}function P(t,r){var o=i[t],s=i[r],l=o[o.length-1],a=o[o.length-2],c=s[0],h=s[1];e.pointsCollinear(a,l,c)&&(n&&n.chainRemoveTail(t,l),o.pop(),l=a),e.pointsCollinear(l,c,h)&&(n&&n.chainRemoveHead(r,c),s.shift()),n&&n.chainJoin(t,r),i[t]=o.concat(s),i.splice(r,1)}})),r}},557:t=>{function e(t,e,n){var i=[];return t.forEach((function(t){var r=(t.myFill.above?8:0)+(t.myFill.below?4:0)+(t.otherFill&&t.otherFill.above?2:0)+(t.otherFill&&t.otherFill.below?1:0);0!==e[r]&&i.push({id:n?n.segmentId():-1,start:t.start,end:t.end,myFill:{above:1===e[r],below:2===e[r]},otherFill:null})})),n&&n.selected(i),i}var n={union:function(t,n){return e(t,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],n)},intersect:function(t,n){return e(t,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],n)},difference:function(t,n){return e(t,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],n)},differenceRev:function(t,n){return e(t,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],n)},xor:function(t,n){return e(t,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],n)}};t.exports=n},222:(t,e,n)=>{"use strict";function i(t,e){return t===e}function r(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var i=e.length,r=0;r<i;r++)if(!t(e[r],n[r]))return!1;return!0}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=null,o=null;return function(){return r(e,n,arguments)||(o=t.apply(null,arguments)),n=arguments,o}}function s(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var n=e.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return e}function l(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var o=0,l=i.pop(),a=s(i),c=t.apply(void 0,[function(){return o++,l.apply(null,arguments)}].concat(n)),h=t((function(){for(var t=[],e=a.length,n=0;n<e;n++)t.push(a[n].apply(null,arguments));return c.apply(null,t)}));return h.resultFunc=l,h.dependencies=a,h.recomputations=function(){return o},h.resetRecomputations=function(){return o=0},h}}n.r(e),n.d(e,{defaultMemoize:()=>o,createSelectorCreator:()=>l,createSelector:()=>a,createStructuredSelector:()=>c});var a=l(o);function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;if("object"!=typeof t)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof t);var n=Object.keys(t);return e(n.map((function(e){return t[e]})),(function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce((function(t,e,i){return t[n[i]]=e,t}),{})}))}},121:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i}),t=n.hmd(t);const i=function(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:t)}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={id:i,loaded:!1,exports:{}};return t[i](r,r.exports,n),r.loaded=!0,r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=Array.isArray;function e(t){var e=typeof t;return"string"===e||"number"===e}function i(t){return null==t}function r(t){return null===t||!1===t||!0===t||void 0===t}function o(t){return"function"==typeof t}function s(t){return"string"==typeof t}function l(t){return null===t}function a(t,e){var n={};if(t)for(var i in t)n[i]=t[i];if(e)for(var r in e)n[r]=e[r];return n}function c(t){return!l(t)&&"object"==typeof t}var h={};function u(t){return t.substr(2).toLowerCase()}function f(t,e){t.appendChild(e)}function p(t,e,n){l(n)?f(t,e):t.insertBefore(e,n)}function d(t,e){t.removeChild(e)}function g(t){for(var e=0;e<t.length;e++)t[e]()}function m(t,e,n){var i=t.children;return 4&n?i.$LI:8192&n?2===t.childFlags?i:i[e?0:i.length-1]:i}function _(t,e){for(var n;t;){if(2033&(n=t.flags))return t.dom;t=m(t,e,n)}return null}function v(t,e){do{var n=t.flags;if(2033&n)return void d(e,t.dom);var i=t.children;if(4&n&&(t=i.$LI),8&n&&(t=i),8192&n){if(2!==t.childFlags){for(var r=0,o=i.length;r<o;++r)v(i[r],e);return}t=i}}while(t)}function y(t,e,n){do{var i=t.flags;if(2033&i)return void p(e,t.dom,n);var r=t.children;if(4&i&&(t=r.$LI),8&i&&(t=r),8192&i){if(2!==t.childFlags){for(var o=0,s=r.length;o<s;++o)y(r[o],e,n);return}t=r}}while(t)}function b(t,e,n){return t.constructor.getDerivedStateFromProps?a(n,t.constructor.getDerivedStateFromProps(e,n)):n}var w={v:!1},x={componentComparator:null,createVNode:null,renderComplete:null};function k(t,e){t.textContent=e}function S(t,e){return c(t)&&t.event===e.event&&t.data===e.data}function C(t,e){for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t}function P(t,e){return!!o(t)&&(t(e),!0)}var M="$";function T(t,e,n,i,r,o,s,l){this.childFlags=t,this.children=e,this.className=n,this.dom=null,this.flags=i,this.key=void 0===r?null:r,this.props=void 0===o?null:o,this.ref=void 0===s?null:s,this.type=l}function E(t,e,n,i,r,o,s,l){var a=void 0===r?1:r,c=new T(a,i,n,t,s,o,l,e);return x.createVNode&&x.createVNode(c),0===a&&N(c,c.children),c}function R(t,e,n,r,o){var s=new T(1,null,null,t=function(t,e){return 12&t?t:e.prototype&&e.prototype.render?4:e.render?32776:8}(t,e),r,function(t,e,n){var r=(32768&t?e.render:e).defaultProps;return i(r)?n:i(n)?a(r,null):C(n,r)}(t,e,n),function(t,e,n){if(4&t)return n;var r=(32768&t?e.render:e).defaultHooks;return i(r)?n:i(n)?r:C(n,r)}(t,e,o),e);return x.createVNode&&x.createVNode(s),s}function O(t,e){return new T(1,i(t)||!0===t||!1===t?"":t,null,16,e,null,null,null)}function I(t,e,n){var i=E(8192,8192,null,t,e,null,n,null);switch(i.childFlags){case 1:i.children=U(),i.childFlags=2;break;case 16:i.children=[O(t)],i.childFlags=4}return i}function A(t){var e=-16385&t.flags,n=t.props;if(14&e&&!l(n)){var i=n;for(var r in n={},i)n[r]=i[r]}return 0==(8192&e)?new T(t.childFlags,t.children,t.className,e,t.key,n,t.ref,t.type):function(t){var e=t.children,n=t.childFlags;return I(2===n?A(e):e.map(A),n,t.key)}(t)}function U(){return O("",null)}function F(n,i,o,a){for(var c=n.length;o<c;o++){var h=n[o];if(!r(h)){var u=a+M+o;if(t(h))F(h,i,0,u);else{if(e(h))h=O(h,u);else{var f=h.key,p=s(f)&&f[0]===M;(81920&h.flags||p)&&(h=A(h)),h.flags|=65536,p?f.substring(0,a.length)!==a&&(h.key=a+f):l(f)?h.key=u:h.key=a+f}i.push(h)}}}}function W(t){switch(t){case"svg":return 32;case"input":return 64;case"select":return 256;case"textarea":return 128;case"$F":return 8192;default:return 1}}function N(n,i){var o,a=1;if(r(i))o=i;else if(e(i))a=16,o=i;else if(t(i)){for(var c=i.length,h=0;h<c;++h){var u=i[h];if(r(u)||t(u)){o=o||i.slice(0,h),F(i,o,h,"");break}if(e(u))(o=o||i.slice(0,h)).push(O(u,M+h));else{var f=u.key,p=(81920&u.flags)>0,d=l(f),g=s(f)&&f[0]===M;p||d||g?(o=o||i.slice(0,h),(p||g)&&(u=A(u)),(d||g)&&(u.key=M+h),o.push(u)):o&&o.push(u),u.flags|=65536}}a=0===(o=o||i).length?1:8}else(o=i).flags|=65536,81920&i.flags&&(o=A(i)),a=2;return n.children=o,n.childFlags=a,n}function D(n){return r(n)||e(n)?O(n,null):t(n)?I(n,0,null):16384&n.flags?A(n):n}var L="http://www.w3.org/1999/xlink",$="http://www.w3.org/XML/1998/namespace",j={"xlink:actuate":L,"xlink:arcrole":L,"xlink:href":L,"xlink:role":L,"xlink:show":L,"xlink:title":L,"xlink:type":L,"xml:base":$,"xml:lang":$,"xml:space":$};function B(t){return{onClick:t,onDblClick:t,onFocusIn:t,onFocusOut:t,onKeyDown:t,onKeyPress:t,onKeyUp:t,onMouseDown:t,onMouseMove:t,onMouseUp:t,onTouchEnd:t,onTouchMove:t,onTouchStart:t}}var z=B(0),X=B(null),H=B(!0);function Y(t,e){var n=e.$EV;return n||(n=e.$EV=B(null)),n[t]||1==++z[t]&&(X[t]=function(t){var e="onClick"===t||"onDblClick"===t?function(t){return function(e){0===e.button?G(e,!0,t,J(e)):e.stopPropagation()}}(t):function(t){return function(e){G(e,!1,t,J(e))}}(t);return document.addEventListener(u(t),e),e}(t)),n}function V(t,e){var n=e.$EV;n&&n[t]&&(0==--z[t]&&(document.removeEventListener(u(t),X[t]),X[t]=null),n[t]=null)}function G(t,e,n,i){var r=function(t){return o(t.composedPath)?t.composedPath()[0]:t.target}(t);do{if(e&&r.disabled)return;var s=r.$EV;if(s){var a=s[n];if(a&&(i.dom=r,a.event?a.event(a.data,t):a(t),t.cancelBubble))return}r=r.parentNode}while(!l(r))}function q(){this.cancelBubble=!0,this.immediatePropagationStopped||this.stopImmediatePropagation()}function K(){return this.defaultPrevented}function Z(){return this.cancelBubble}function J(t){var e={dom:document};return t.isDefaultPrevented=K,t.isPropagationStopped=Z,t.stopPropagation=q,Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return e.dom}}),e}function Q(t,e,n){if(t[e]){var i=t[e];i.event?i.event(i.data,n):i(n)}else{var r=e.toLowerCase();t[r]&&t[r](n)}}function tt(t,e){var n=function(n){var i=this.$V;if(i){var r=i.props||h,l=i.dom;if(s(t))Q(r,t,n);else for(var a=0;a<t.length;++a)Q(r,t[a],n);if(o(e)){var c=this.$V,u=c.props||h;e(u,l,!1,c)}}};return Object.defineProperty(n,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),n}function et(t,e,n){var i="$"+e,r=t[i];if(r){if(r[1].wrapped)return;t.removeEventListener(r[0],r[1]),t[i]=null}o(n)&&(t.addEventListener(e,n),t[i]=[e,n])}function nt(t){return"checkbox"===t||"radio"===t}var it=tt("onInput",st),rt=tt(["onClick","onChange"],st);function ot(t){t.stopPropagation()}function st(t,e){var n=t.type,r=t.value,o=t.checked,s=t.multiple,l=t.defaultValue,a=!i(r);n&&n!==e.type&&e.setAttribute("type",n),i(s)||s===e.multiple||(e.multiple=s),i(l)||a||(e.defaultValue=l+""),nt(n)?(a&&(e.value=r),i(o)||(e.checked=o)):a&&e.value!==r?(e.defaultValue=r,e.value=r):i(o)||(e.checked=o)}function lt(e,n){if("option"===e.type)!function(e,n){var r=e.props||h,o=e.dom;o.value=r.value,r.value===n||t(n)&&-1!==n.indexOf(r.value)?o.selected=!0:i(n)&&i(r.selected)||(o.selected=r.selected||!1)}(e,n);else{var r=e.children,o=e.flags;if(4&o)lt(r.$LI,n);else if(8&o)lt(r,n);else if(2===e.childFlags)lt(r,n);else if(12&e.childFlags)for(var s=0,l=r.length;s<l;++s)lt(r[s],n)}}ot.wrapped=!0;var at=tt("onChange",ct);function ct(t,e,n,r){var o=Boolean(t.multiple);i(t.multiple)||o===e.multiple||(e.multiple=o);var s=t.selectedIndex;if(-1===s&&(e.selectedIndex=-1),1!==r.childFlags){var l=t.value;"number"==typeof s&&s>-1&&e.options[s]&&(l=e.options[s].value),n&&i(l)&&(l=t.defaultValue),lt(r,l)}}var ht,ut,ft=tt("onInput",dt),pt=tt("onChange");function dt(t,e,n){var r=t.value,o=e.value;if(i(r)){if(n){var s=t.defaultValue;i(s)||s===o||(e.defaultValue=s,e.value=s)}}else o!==r&&(e.defaultValue=r,e.value=r)}function gt(t,e,n,i,r,o){64&t?st(i,n):256&t?ct(i,n,r,e):128&t&&dt(i,n,r),o&&(n.$V=e)}function mt(t,e,n){64&t?function(t,e){nt(e.type)?(et(t,"change",rt),et(t,"click",ot)):et(t,"input",it)}(e,n):256&t?function(t){et(t,"change",at)}(e):128&t&&function(t,e){et(t,"input",ft),e.onChange&&et(t,"change",pt)}(e,n)}function _t(t){return t.type&&nt(t.type)?!i(t.checked):!i(t.value)}function vt(t){t&&!P(t,null)&&t.current&&(t.current=null)}function yt(t,e,n){t&&(o(t)||void 0!==t.current)&&n.push((function(){P(t,e)||void 0===t.current||(t.current=e)}))}function bt(t,e){wt(t),v(t,e)}function wt(t){var e,n=t.flags,r=t.children;if(481&n){e=t.ref;var s=t.props;vt(e);var a=t.childFlags;if(!l(s))for(var c=Object.keys(s),u=0,f=c.length;u<f;u++){var p=c[u];H[p]&&V(p,t.dom)}12&a?xt(r):2===a&&wt(r)}else r&&(4&n?(o(r.componentWillUnmount)&&r.componentWillUnmount(),vt(t.ref),r.$UN=!0,wt(r.$LI)):8&n?(!i(e=t.ref)&&o(e.onComponentWillUnmount)&&e.onComponentWillUnmount(_(t,!0),t.props||h),wt(r)):1024&n?bt(r,t.ref):8192&n&&12&t.childFlags&&xt(r))}function xt(t){for(var e=0,n=t.length;e<n;++e)wt(t[e])}function kt(t){t.textContent=""}function St(t,e,n){xt(n),8192&e.flags?v(e,t):kt(t)}function Ct(t,e,n,r){var o=t&&t.__html||"",s=e&&e.__html||"";o!==s&&(i(s)||function(t,e){var n=document.createElement("i");return n.innerHTML=e,n.innerHTML===t.innerHTML}(r,s)||(l(n)||(12&n.childFlags?xt(n.children):2===n.childFlags&&wt(n.children),n.children=null,n.childFlags=1),r.innerHTML=s))}function Pt(t,e,n,r,l,a,h){switch(t){case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":case"selectedIndex":break;case"autoFocus":r.autofocus=!!n;break;case"allowfullscreen":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":r[t]=!!n;break;case"defaultChecked":case"value":case"volume":if(a&&"value"===t)break;var f=i(n)?"":n;r[t]!==f&&(r[t]=f);break;case"style":!function(t,e,n){if(i(e))n.removeAttribute("style");else{var r,o,l=n.style;if(s(e))l.cssText=e;else if(i(t)||s(t))for(r in e)o=e[r],l.setProperty(r,o);else{for(r in e)(o=e[r])!==t[r]&&l.setProperty(r,o);for(r in t)i(e[r])&&l.removeProperty(r)}}}(e,n,r);break;case"dangerouslySetInnerHTML":Ct(e,n,h,r);break;default:H[t]?function(t,e,n,i){if(o(n))Y(t,i)[t]=n;else if(c(n)){if(S(e,n))return;Y(t,i)[t]=n}else V(t,i)}(t,e,n,r):111===t.charCodeAt(0)&&110===t.charCodeAt(1)?function(t,e,n,i){if(c(n)){if(S(e,n))return;n=function(t){var e=t.event;return function(n){e(t.data,n)}}(n)}et(i,u(t),n)}(t,e,n,r):i(n)?r.removeAttribute(t):l&&j[t]?r.setAttributeNS(j[t],t,n):r.setAttribute(t,n)}}function Mt(t,e,n){var i=D(t.render(e,t.state,n)),r=n;return o(t.getChildContext)&&(r=a(n,t.getChildContext())),t.$CX=r,i}function Tt(t,e){var n=t.props||h;return 32768&t.flags?t.type.render(n,t.ref,e):t.type(n,e)}function Et(t,e,n,r,s,a){var c=t.flags|=16384;481&c?function(t,e,n,r,o,s){var a=t.flags,c=t.props,h=t.className,u=t.childFlags,f=t.dom=function(t,e){return e?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t)}(t.type,r=r||(32&a)>0),d=t.children;i(h)||""===h||(r?f.setAttribute("class",h):f.className=h);if(16===u)k(f,d);else if(1!==u){var g=r&&"foreignObject"!==t.type;2===u?(16384&d.flags&&(t.children=d=A(d)),Et(d,f,n,g,null,s)):8!==u&&4!==u||Ot(d,f,n,g,null,s)}l(e)||p(e,f,o);l(c)||function(t,e,n,i,r){var o=!1,s=(448&e)>0;for(var l in s&&(o=_t(n))&&mt(e,i,n),n)Pt(l,null,n[l],i,r,o,null);s&&gt(e,t,i,n,!0,o)}(t,a,c,f,r);yt(t.ref,f,s)}(t,e,n,r,s,a):4&c?function(t,e,n,i,r,s){var a=function(t,e,n,i,r,s){var a=new e(n,i),c=a.$N=Boolean(e.getDerivedStateFromProps||a.getSnapshotBeforeUpdate);if(a.$SVG=r,a.$L=s,t.children=a,a.$BS=!1,a.context=i,a.props===h&&(a.props=n),c)a.state=b(a,n,a.state);else if(o(a.componentWillMount)){a.$BR=!0,a.componentWillMount();var u=a.$PS;if(!l(u)){var f=a.state;if(l(f))a.state=u;else for(var p in u)f[p]=u[p];a.$PS=null}a.$BR=!1}return a.$LI=Mt(a,n,i),a}(t,t.type,t.props||h,n,i,s);Et(a.$LI,e,a.$CX,i,r,s),function(t,e,n){yt(t,e,n),o(e.componentDidMount)&&n.push(function(t){return function(){t.componentDidMount()}}(e))}(t.ref,a,s)}(t,e,n,r,s,a):8&c?(function(t,e,n,i,r,o){Et(t.children=D(Tt(t,n)),e,n,i,r,o)}(t,e,n,r,s,a),function(t,e){var n=t.ref;i(n)||(P(n.onComponentWillMount,t.props||h),o(n.onComponentDidMount)&&e.push(function(t,e){return function(){t.onComponentDidMount(_(e,!0),e.props||h)}}(n,t)))}(t,a)):512&c||16&c?Rt(t,e,s):8192&c?function(t,e,n,i,r,o){var s=t.children,l=t.childFlags;12&l&&0===s.length&&(l=t.childFlags=2,s=t.children=U());2===l?Et(s,n,r,i,r,o):Ot(s,n,e,i,r,o)}(t,n,e,r,s,a):1024&c&&function(t,e,n,i,r){Et(t.children,t.ref,e,!1,null,r);var o=U();Rt(o,n,i),t.dom=o.dom}(t,n,e,s,a)}function Rt(t,e,n){var i=t.dom=document.createTextNode(t.children);l(e)||p(e,i,n)}function Ot(t,e,n,i,r,o){for(var s=0;s<t.length;++s){var l=t[s];16384&l.flags&&(t[s]=l=A(l)),Et(l,e,n,i,r,o)}}function It(t,e,n,s,c,u,p){var g=e.flags|=16384;t.flags!==g||t.type!==e.type||t.key!==e.key||2048&g?16384&t.flags?function(t,e,n,i,r,o){wt(t),0!=(e.flags&t.flags&2033)?(Et(e,null,i,r,null,o),function(t,e,n){t.replaceChild(e,n)}(n,e.dom,t.dom)):(Et(e,n,i,r,_(t,!0),o),v(t,n))}(t,e,n,s,c,p):Et(e,n,s,c,u,p):481&g?function(t,e,n,r,o,s){var l,a=e.dom=t.dom,c=t.props,u=e.props,f=!1,p=!1;if(r=r||(32&o)>0,c!==u){var d=c||h;if((l=u||h)!==h)for(var g in(f=(448&o)>0)&&(p=_t(l)),l){var m=d[g],_=l[g];m!==_&&Pt(g,m,_,a,r,p,t)}if(d!==h)for(var v in d)i(l[v])&&!i(d[v])&&Pt(v,d[v],null,a,r,p,t)}var y=e.children,b=e.className;t.className!==b&&(i(b)?a.removeAttribute("class"):r?a.setAttribute("class",b):a.className=b);4096&o?function(t,e){t.textContent!==e&&(t.textContent=e)}(a,y):At(t.childFlags,e.childFlags,t.children,y,a,n,r&&"foreignObject"!==e.type,null,t,s);f&&gt(o,e,a,l,!1,p);var w=e.ref,x=t.ref;x!==w&&(vt(x),yt(w,a,s))}(t,e,s,c,g,p):4&g?function(t,e,n,i,r,s,c){var u=e.children=t.children;if(l(u))return;u.$L=c;var f=e.props||h,p=e.ref,d=t.ref,g=u.state;if(!u.$N){if(o(u.componentWillReceiveProps)){if(u.$BR=!0,u.componentWillReceiveProps(f,i),u.$UN)return;u.$BR=!1}l(u.$PS)||(g=a(g,u.$PS),u.$PS=null)}Ut(u,g,f,n,i,r,!1,s,c),d!==p&&(vt(d),yt(p,u,c))}(t,e,n,s,c,u,p):8&g?function(t,e,n,r,s,l,a){var c=!0,u=e.props||h,f=e.ref,p=t.props,d=!i(f),g=t.children;d&&o(f.onComponentShouldUpdate)&&(c=f.onComponentShouldUpdate(p,u));if(!1!==c){d&&o(f.onComponentWillUpdate)&&f.onComponentWillUpdate(p,u);var m=D(Tt(e,r));It(g,m,n,r,s,l,a),e.children=m,d&&o(f.onComponentDidUpdate)&&f.onComponentDidUpdate(p,u)}else e.children=g}(t,e,n,s,c,u,p):16&g?function(t,e){var n=e.children,i=e.dom=t.dom;n!==t.children&&(i.nodeValue=n)}(t,e):512&g?e.dom=t.dom:8192&g?function(t,e,n,i,r,o){var s=t.children,l=e.children,a=t.childFlags,c=e.childFlags,h=null;12&c&&0===l.length&&(c=e.childFlags=2,l=e.children=U());var u=0!=(2&c);if(12&a){var f=s.length;(8&a&&8&c||u||!u&&l.length>f)&&(h=_(s[f-1],!1).nextSibling)}At(a,c,s,l,n,i,r,h,t,o)}(t,e,n,s,c,p):function(t,e,n,i){var o=t.ref,s=e.ref,l=e.children;if(At(t.childFlags,e.childFlags,t.children,l,o,n,!1,null,t,i),e.dom=t.dom,o!==s&&!r(l)){var a=l.dom;d(o,a),f(s,a)}}(t,e,s,p)}function At(t,e,n,i,r,o,s,l,a,c){switch(t){case 2:switch(e){case 2:It(n,i,r,o,s,l,c);break;case 1:bt(n,r);break;case 16:wt(n),k(r,i);break;default:!function(t,e,n,i,r,o){wt(t),Ot(e,n,i,r,_(t,!0),o),v(t,n)}(n,i,r,o,s,c)}break;case 1:switch(e){case 2:Et(i,r,o,s,l,c);break;case 1:break;case 16:k(r,i);break;default:Ot(i,r,o,s,l,c)}break;case 16:switch(e){case 16:!function(t,e,n){t!==e&&(""!==t?n.firstChild.nodeValue=e:k(n,e))}(n,i,r);break;case 2:kt(r),Et(i,r,o,s,l,c);break;case 1:kt(r);break;default:kt(r),Ot(i,r,o,s,l,c)}break;default:switch(e){case 16:xt(n),k(r,i);break;case 2:St(r,a,n),Et(i,r,o,s,l,c);break;case 1:St(r,a,n);break;default:var h=0|n.length,u=0|i.length;0===h?u>0&&Ot(i,r,o,s,l,c):0===u?St(r,a,n):8===e&&8===t?function(t,e,n,i,r,o,s,l,a,c){var h,u,f=o-1,p=s-1,d=0,g=t[d],m=e[d];t:{for(;g.key===m.key;){if(16384&m.flags&&(e[d]=m=A(m)),It(g,m,n,i,r,l,c),t[d]=m,++d>f||d>p)break t;g=t[d],m=e[d]}for(g=t[f],m=e[p];g.key===m.key;){if(16384&m.flags&&(e[p]=m=A(m)),It(g,m,n,i,r,l,c),t[f]=m,p--,d>--f||d>p)break t;g=t[f],m=e[p]}}if(d>f){if(d<=p)for(u=(h=p+1)<s?_(e[h],!0):l;d<=p;)16384&(m=e[d]).flags&&(e[d]=m=A(m)),++d,Et(m,n,i,r,u,c)}else if(d>p)for(;d<=f;)bt(t[d++],n);else!function(t,e,n,i,r,o,s,l,a,c,h,u,f){var p,d,g,m=0,v=l,b=l,w=o-l+1,x=s-l+1,k=new Int32Array(x+1),S=w===i,C=!1,P=0,M=0;if(r<4||(w|x)<32)for(m=v;m<=o;++m)if(p=t[m],M<x){for(l=b;l<=s;l++)if(d=e[l],p.key===d.key){if(k[l-b]=m+1,S)for(S=!1;v<m;)bt(t[v++],a);P>l?C=!0:P=l,16384&d.flags&&(e[l]=d=A(d)),It(p,d,a,n,c,h,f),++M;break}!S&&l>s&&bt(p,a)}else S||bt(p,a);else{var T={};for(m=b;m<=s;++m)T[e[m].key]=m;for(m=v;m<=o;++m)if(p=t[m],M<x)if(void 0!==(l=T[p.key])){if(S)for(S=!1;m>v;)bt(t[v++],a);k[l-b]=m+1,P>l?C=!0:P=l,16384&(d=e[l]).flags&&(e[l]=d=A(d)),It(p,d,a,n,c,h,f),++M}else S||bt(p,a);else S||bt(p,a)}if(S)St(a,u,t),Ot(e,a,n,c,h,f);else if(C){var E=function(t){var e=0,n=0,i=0,r=0,o=0,s=0,l=0,a=t.length;a>Ft&&(Ft=a,ht=new Int32Array(a),ut=new Int32Array(a));for(;n<a;++n)if(0!==(e=t[n])){if(t[i=ht[r]]<e){ut[n]=i,ht[++r]=n;continue}for(o=0,s=r;o<s;)t[ht[l=o+s>>1]]<e?o=l+1:s=l;e<t[ht[o]]&&(o>0&&(ut[n]=ht[o-1]),ht[o]=n)}o=r+1;var c=new Int32Array(o);s=ht[o-1];for(;o-- >0;)c[o]=s,s=ut[s],ht[o]=0;return c}(k);for(l=E.length-1,m=x-1;m>=0;m--)0===k[m]?(16384&(d=e[P=m+b]).flags&&(e[P]=d=A(d)),Et(d,a,n,c,(g=P+1)<r?_(e[g],!0):h,f)):l<0||m!==E[l]?y(d=e[P=m+b],a,(g=P+1)<r?_(e[g],!0):h):l--}else if(M!==x)for(m=x-1;m>=0;m--)0===k[m]&&(16384&(d=e[P=m+b]).flags&&(e[P]=d=A(d)),Et(d,a,n,c,(g=P+1)<r?_(e[g],!0):h,f))}(t,e,i,o,s,f,p,d,n,r,l,a,c)}(n,i,r,o,s,h,u,l,a,c):function(t,e,n,i,r,o,s,l,a){for(var c,h,u=o>s?s:o,f=0;f<u;++f)c=e[f],h=t[f],16384&c.flags&&(c=e[f]=A(c)),It(h,c,n,i,r,l,a),t[f]=c;if(o<s)for(f=u;f<s;++f)16384&(c=e[f]).flags&&(c=e[f]=A(c)),Et(c,n,i,r,l,a);else if(o>s)for(f=u;f<o;++f)bt(t[f],n)}(n,i,r,o,s,h,u,l,c)}}}function Ut(t,e,n,i,r,s,l,c,h){var u=t.state,f=t.props,p=Boolean(t.$N),d=o(t.shouldComponentUpdate);if(p&&(e=b(t,n,e!==u?a(u,e):e)),l||!d||d&&t.shouldComponentUpdate(n,e,r)){!p&&o(t.componentWillUpdate)&&t.componentWillUpdate(n,e,r),t.props=n,t.state=e,t.context=r;var g=null,m=Mt(t,n,r);p&&o(t.getSnapshotBeforeUpdate)&&(g=t.getSnapshotBeforeUpdate(f,u)),It(t.$LI,m,i,t.$CX,s,c,h),t.$LI=m,o(t.componentDidUpdate)&&function(t,e,n,i,r){r.push((function(){t.componentDidUpdate(e,n,i)}))}(t,f,u,g,h)}else t.props=n,t.state=e,t.context=r}var Ft=0;function Wt(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=h),function(t,e,n,r){var s=[],l=e.$V;w.v=!0,i(l)?i(t)||(16384&t.flags&&(t=A(t)),Et(t,e,r,!1,null,s),e.$V=t,l=t):i(t)?(bt(l,e),e.$V=null):(16384&t.flags&&(t=A(t)),It(l,t,e,r,!1,null,s),l=e.$V=t),g(s),w.v=!1,o(n)&&n(),o(x.renderComplete)&&x.renderComplete(l,e)}(t,e,n,r)}"undefined"!=typeof document&&window.Node&&(Node.prototype.$EV=null,Node.prototype.$V=null);var Nt=[],Dt="undefined"!=typeof Promise?Promise.resolve().then.bind(Promise.resolve()):function(t){window.setTimeout(t,0)},Lt=!1;function $t(t,e,n,r){var s=t.$PS;if(o(e)&&(e=e(s?a(t.state,s):t.state,t.props,t.context)),i(s))t.$PS=e;else for(var l in e)s[l]=e[l];if(t.$BR)o(n)&&t.$L.push(n.bind(t));else{if(!w.v&&0===Nt.length)return zt(t,r),void(o(n)&&n.call(t));if(-1===Nt.indexOf(t)&&Nt.push(t),r&&(t.$F=!0),Lt||(Lt=!0,Dt(Bt)),o(n)){var c=t.$QU;c||(c=t.$QU=[]),c.push(n)}}}function jt(t){for(var e=t.$QU,n=0;n<e.length;++n)e[n].call(t);t.$QU=null}function Bt(){var t;for(Lt=!1;t=Nt.shift();)if(!t.$UN){var e=t.$F;t.$F=!1,zt(t,e),t.$QU&&jt(t)}}function zt(t,e){if(e||!t.$BR){var n=t.$PS;t.$PS=null;var i=[];w.v=!0,Ut(t,a(t.state,n),t.props,_(t.$LI,!0).parentNode,t.context,t.$SVG,e,null,i),g(i),w.v=!1}else t.state=t.$PS,t.$PS=null}var Xt=function(t,e){this.state=null,this.$BR=!1,this.$BS=!0,this.$PS=null,this.$LI=null,this.$UN=!1,this.$CX=null,this.$QU=null,this.$N=!1,this.$L=null,this.$SVG=!1,this.$F=!1,this.props=t||h,this.context=e||h};Xt.prototype.forceUpdate=function(t){this.$UN||$t(this,{},t,!0)},Xt.prototype.setState=function(t,e){this.$UN||this.$BS||$t(this,t,e,!1)},Xt.prototype.render=function(t,e,n){return null};function Ht(t){return null==t}function Yt(t){return"string"==typeof t}function Vt(t){return void 0===t}var Gt={onComponentDidMount:1,onComponentDidUpdate:1,onComponentShouldUpdate:1,onComponentWillMount:1,onComponentWillUnmount:1,onComponentWillUpdate:1};function qt(t,e,n){var i,r,o=arguments,s=null,l=null,a=null,c=0,h=arguments.length-2;if(1===h)i=n;else if(h>1)for(i=[];h-- >0;)i[h]=o[h+2];if(!Yt(t)){if(c=2,Vt(i)||(e||(e={}),e.children=i),!Ht(e))for(var u in r={},e)"key"===u?l=e.key:"ref"===u?s=e.ref:1===Gt[u]?(s||(s={}),s[u]=e[u]):r[u]=e[u];return R(c,t,r,l,s)}if(c=W(t),!Ht(e))for(var f in r={},e)"className"===f||"class"===f?a=e[f]:"key"===f?l=e.key:"children"===f&&Vt(i)?i=e.children:"ref"===f?s=e.ref:("contenteditable"===f&&(c|=4096),r[f]=e[f]);return 8192&c?I(1===h?[i]:i,0,l):E(c,t,a,i,0,r,l,s)}var Kt=n(121),Zt=function(){return Math.random().toString(36).substring(7).split("").join(".")},Jt={INIT:"@@redux/INIT"+Zt(),REPLACE:"@@redux/REPLACE"+Zt(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Zt()}};function Qt(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function te(t,e,n){var i;if("function"==typeof e&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(te)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var r=t,o=e,s=[],l=s,a=!1;function c(){l===s&&(l=s.slice())}function h(){if(a)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function u(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(a)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var e=!0;return c(),l.push(t),function(){if(e){if(a)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");e=!1,c();var n=l.indexOf(t);l.splice(n,1),s=null}}}function f(t){if(!Qt(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(a)throw new Error("Reducers may not dispatch actions.");try{a=!0,o=r(o,t)}finally{a=!1}for(var e=s=l,n=0;n<e.length;n++){(0,e[n])()}return t}function p(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");r=t,f({type:Jt.REPLACE})}function d(){var t,e=u;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(h())}return n(),{unsubscribe:e(n)}}})[Kt.Z]=function(){return this},t}return f({type:Jt.INIT}),(i={dispatch:f,subscribe:u,getState:h,replaceReducer:p})[Kt.Z]=d,i}var ee="ADD_SANDWICH",ne="CHANGE_GRATUITY",ie="CHANGE_SANDWICH_NAME",re="CHANGE_STAGED_SANDWICH_NAME",oe="NEW_ORDER",se="POP_INGREDIENT",le="PUSH_INGREDIENT",ae="REMOVE_SANDWICH",ce="SELECT_INGREDIENT_TO_PUSH",he="INITIALIZE",ue="COMPLETE_ORDER";function fe(t){return function(t){if(Array.isArray(t))return pe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return pe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pe(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function de(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ge(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?de(Object(n),!0).forEach((function(e){me(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const _e=2.3283064365386963e-10;class ve{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*_e,t=69069*t+1>>>0,this._s1=t*_e,t=69069*t+1>>>0,this._s2=t*_e,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*_e;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let n=Math.max(t,e),i=Math.min(t,e);return Math.floor(this.getUniform()*(n-i+1))+i}getNormal(t=0,e=1){let n,i,r;do{n=2*this.getUniform()-1,i=2*this.getUniform()-1,r=n*n+i*i}while(r>1||0==r);return t+n*Math.sqrt(-2*Math.log(r)/r)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],n=t.slice();for(;n.length;){let t=n.indexOf(this.getItem(n));e.push(n.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let n in t)e+=t[n];let n,i=this.getUniform()*e,r=0;for(n in t)if(r+=t[n],i<r)return n;return n}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new ve).setState(this.getState())}}const ye=(new ve).setSeed(Date.now());class be{getContainer(){return null}setOptions(t){this._options=t}}class we extends be{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let n=this._ctx.canvas,i=n.getBoundingClientRect();return t-=i.left,e-=i.top,t*=n.width/i.width,e*=n.height/i.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}function xe(t,e){return(t%e+e)%e}class ke extends we{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[n,i,r,o,s]=t,l=[(n+1)*this._spacingX,i*this._spacingY+this._hexSize];if(this._options.transpose&&l.reverse(),e&&(this._ctx.fillStyle=s,this._fill(l[0],l[1])),!r)return;this._ctx.fillStyle=o;let a=[].concat(r);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],l[0],Math.ceil(l[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,i=e/(2+1.5*(this._options.height-1)),r=Math.min(n,i),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let l=s/100;r=Math.floor(r)+1;let a=2*r/(this._options.spacing*(1+l/Math.sqrt(3)));return Math.ceil(a)-1}_normalizedEventToPosition(t,e){let n;this._options.transpose?(t+=e,t-=e=t-e,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let i=n/this._options.height;return xe(e=Math.floor(e/i),2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let n=this._hexSize,i=this._options.border;const r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-n+i,e),r.lineTo(t-n/2+i,e+this._spacingX-i),r.lineTo(t+n/2-i,e+this._spacingX-i),r.lineTo(t+n-i,e),r.lineTo(t+n/2-i,e-this._spacingX+i),r.lineTo(t-n/2+i,e-this._spacingX+i),r.lineTo(t-n+i,e)):(r.moveTo(t,e-n+i),r.lineTo(t+this._spacingX-i,e-n/2+i),r.lineTo(t+this._spacingX-i,e+n/2-i),r.lineTo(t,e+n-i),r.lineTo(t-this._spacingX+i,e+n/2-i),r.lineTo(t-this._spacingX+i,e-n/2+i),r.lineTo(t,e-n+i)),r.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let n,i;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(n="height",i="width"):(n="width",i="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[i]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}const Se=(()=>{class t extends we{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,n){t.cache?this._drawWithCache(e):this._drawNoCache(e,n)}_drawWithCache(t){let e,[n,i,r,o,s]=t,l=""+r+o+s;if(l in this._canvasCache)e=this._canvasCache[l];else{let t=this._options.border;e=document.createElement("canvas");let n=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,n.fillStyle=s,n.fillRect(t,t,e.width-t,e.height-t),r){n.fillStyle=o,n.font=this._ctx.font,n.textAlign="center",n.textBaseline="middle";let t=[].concat(r);for(let e=0;e<t.length;e++)n.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[l]=e}this._ctx.drawImage(e,n*this._spacingX,i*this._spacingY)}_drawNoCache(t,e){let[n,i,r,o,s]=t;if(e){let t=this._options.border;this._ctx.fillStyle=s,this._ctx.fillRect(n*this._spacingX+t,i*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!r)return;this._ctx.fillStyle=o;let l=[].concat(r);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],(n+.5)*this._spacingX,Math.ceil((i+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let n=Math.floor(t/this._options.width),i=Math.floor(e/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let s=o/100*i/n;return s>1&&(i=Math.floor(i/s)),Math.floor(i/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class Ce extends we{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[n,i,r,o,s]=t,l=this._options.tileWidth,a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(n*l,i*a,l,a):(this._ctx.fillStyle=s,this._ctx.fillRect(n*l,i*a,l,a))),!r)return;let c=[].concat(r),h=[].concat(o),u=[].concat(s);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);if(this._options.tileColorize){let r=this._colorCanvas,o=r.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,l,a);let s=h[t],c=u[t];o.drawImage(this._options.tileSet,e[0],e[1],l,a,0,0,l,a),"transparent"!=s&&(o.fillStyle=s,o.globalCompositeOperation="source-atop",o.fillRect(0,0,l,a)),"transparent"!=c&&(o.fillStyle=c,o.globalCompositeOperation="destination-over",o.fillRect(0,0,l,a)),this._ctx.drawImage(r,n*l,i*a,l,a)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],l,a,n*l,i*a,l,a)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}function Pe(t){let e,n;if(t in Me)e=Me[t];else{if("#"==t.charAt(0)){let n=(t.match(/[0-9a-f]/gi)||[]).map((t=>parseInt(t,16)));if(3==n.length)e=n.map((t=>17*t));else{for(let t=0;t<3;t++)n[t+1]+=16*n[t],n.splice(t,1);e=n}}else e=(n=t.match(/rgb\(([0-9, ]+)\)/i))?n[1].split(/\s*,\s*/).map((t=>parseInt(t))):[0,0,0];Me[t]=e}return e.slice()}const Me={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class Te extends be{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",(()=>this._updateTexture(e))):this._updateTexture(e)}draw(t,e){const n=this._gl,i=this._options;let[r,o,s,l,a]=t,c=n.canvas.height-(o+1)*i.tileHeight;if(n.scissor(r*i.tileWidth,c,i.tileWidth,i.tileHeight),e&&(i.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...Ae(a)),n.clear(n.COLOR_BUFFER_BIT)),!s)return;let h=[].concat(s),u=[].concat(a),f=[].concat(l);n.uniform2fv(this._uniforms.targetPosRel,[r,o]);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,i.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,e),i.tileColorize&&(n.uniform4fv(this._uniforms.tint,Ae(f[t])),n.uniform4fv(this._uniforms.bg,Ae(u[t]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...Ae(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let n=this._gl.canvas,i=n.getBoundingClientRect();return t-=i.left,e-=i.top,t*=n.width/i.width,e*=n.height/i.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,n){const i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i)||"");const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const o=t.createProgram();if(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,Re,Oe);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),Ee.forEach((n=>this._uniforms[n]=t.getUniformLocation(e,n))),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,n=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){!function(t,e){let n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const Ee=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],Re="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),Oe="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let Ie={};function Ae(t){if(!(t in Ie)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=Pe(t).map((t=>t/255)),e.push(1);Ie[t]=e}return Ie[t]}function Ue(t){const e=6/256;let n=Pe(t);return 36*Math.floor(n[0]*e)+6*Math.floor(n[1]*e)+1*Math.floor(n[2]*e)+16}class Fe extends be{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],n=this.computeSize();this._offset=n.map(((t,n)=>Math.floor((t-e[n])/2)))}clear(){process.stdout.write(`[0;48;5;${Ue(this._options.bg)}m[2J`)}draw(t,e){let[n,i,r,o,s]=t,l=this._offset[0]+n,a=this._offset[1]+i,c=this.computeSize();if(l<0||l>=c[0])return;if(a<0||a>=c[1])return;if(l===this._cursor[0]&&a===this._cursor[1]||(process.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(l,a)),this._cursor[0]=l,this._cursor[1]=a),e&&(r||(r=" ")),!r)return;let h=function(t,e){return`[0;38;5;${Ue(t)};48;5;${Ue(e)}m`}(o,s);if(h!==this._lastColor&&(process.stdout.write(h),this._lastColor=h),"\t"!=r){let t=[].concat(r);process.stdout.write(t[0])}this._cursor[0]++,this._cursor[0]>=c[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const We=/%([bc]){([^}]*)}/g;function Ne(t,e){let n=[],i=0;t.replace(We,(function(e,r,o,s){let l=t.substring(i,s);return l.length&&n.push({type:0,value:l}),n.push({type:"c"==r?2:3,value:o.trim()}),i=s+e.length,""}));let r=t.substring(i);return r.length&&n.push({type:0,value:r}),function(t,e){e||(e=1/0);let n=0,i=0,r=-1;for(;n<t.length;){let o=t[n];if(1==o.type&&(i=0,r=-1),0!=o.type){n++;continue}for(;0==i&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let s=o.value.indexOf("\n");if(-1!=s){o.value=De(t,n,s,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(i+o.value.length>e){let s=-1;for(;;){let t=o.value.indexOf(" ",s+1);if(-1==t)break;if(i+t>e)break;s=t}if(-1!=s)o.value=De(t,n,s,!0);else if(-1!=r){let e=t[r],i=e.value.lastIndexOf(" ");e.value=De(t,r,i,!0),n=r}else o.value=De(t,n,e-i,!1)}else i+=o.value.length,-1!=o.value.indexOf(" ")&&(r=n);n++}else t.splice(n,1)}t.push({type:1});let o=null;for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case 0:o=n;break;case 1:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(n,e)}function De(t,e,n,i){let r={type:1},o={type:0,value:t[e].value.substring(n+(i?1:0))};return t.splice(e+1,0,r,o),t[e].value.substring(0,n)}const Le={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},$e={hex:ke,rect:Se,tile:Ce,"tile-gl":Te,term:Fe},je={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},je,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,n){let i=[this._options.bg,this._options.fg];this.draw(t,e,null,null,i[n%i.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=$e[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,n;return"touches"in t?(e=t.touches[0].clientX,n=t.touches[0].clientY):(e=t.clientX,n=t.clientY),this._backend.eventToPosition(e,n)}draw(t,e,n,i,r){i||(i=this._options.fg),r||(r=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,n,i,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(t,e,n,i){let r=null,o=null,s=t,l=e,a=1;i||(i=this._options.width-t);let c=Ne(n,i);for(;c.length;){let e=c.shift();switch(e.type){case 0:let n=!1,i=!1,c=!1,h=!1;for(let t=0;t<e.value.length;t++){let a=e.value.charCodeAt(t),u=e.value.charAt(t);if("term"===this._options.layout){let t=a>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||a>=43360&&a<=43391){this.draw(s+0,l,u,r,o),this.draw(s+1,l,"\t",r,o),s+=2;continue}}c=a>65280&&a<65377||a>65500&&a<65512||a>65518,n=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!h||c||n||s++,c&&!i&&s++,this.draw(s++,l,u,r,o),i=n,h=c}break;case 2:r=e.value||null;break;case 3:o=e.value||null;break;case 1:s=t,l++,a++}}return a}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let n=this._data[t];n[4]!=this._options.bg&&(e=!0),this._backend.draw(n,e)}}t.Rect=Se,t.Hex=ke,t.Tile=Ce,t.TileGL=Te,t.Term=Fe})();class Be{constructor(t=80,e=25){this._width=t,this._height=e}_fillMap(t){let e=[];for(let n=0;n<this._width;n++){e.push([]);for(let i=0;i<this._height;i++)e[n].push(t)}return e}}class ze extends Be{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class Xe{}class He extends Xe{constructor(t,e,n,i,r,o){super(),this._x1=t,this._y1=e,this._x2=n,this._y2=i,this._doors={},void 0!==r&&void 0!==o&&this.addDoor(r,o)}static createRandomAt(t,e,n,i,r){let o=r.roomWidth[0],s=r.roomWidth[1],l=ye.getUniformInt(o,s);o=r.roomHeight[0],s=r.roomHeight[1];let a=ye.getUniformInt(o,s);if(1==n){let n=e-Math.floor(ye.getUniform()*a);return new this(t+1,n,t+l,n+a-1,t,e)}if(-1==n){let n=e-Math.floor(ye.getUniform()*a);return new this(t-l,n,t-1,n+a-1,t,e)}if(1==i){let n=t-Math.floor(ye.getUniform()*l);return new this(n,e+1,n+l-1,e+a,t,e)}if(-1==i){let n=t-Math.floor(ye.getUniform()*l);return new this(n,e-a,n+l-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,n){let i=n.roomWidth[0],r=n.roomWidth[1],o=ye.getUniformInt(i,r);i=n.roomHeight[0],r=n.roomHeight[1];let s=ye.getUniformInt(i,r),l=t-Math.floor(ye.getUniform()*o),a=e-Math.floor(ye.getUniform()*s);return new this(l,a,l+o-1,a+s-1)}static createRandom(t,e,n){let i=n.roomWidth[0],r=n.roomWidth[1],o=ye.getUniformInt(i,r);i=n.roomHeight[0],r=n.roomHeight[1];let s=ye.getUniformInt(i,r),l=t-o-1,a=e-s-1,c=1+Math.floor(ye.getUniform()*l),h=1+Math.floor(ye.getUniform()*a);return new this(c,h,c+o-1,h+s-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let n=e.split(",");t(parseInt(n[0]),parseInt(n[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1;for(let o=e;o<=n;o++)for(let s=i;s<=r;s++)o!=e&&o!=n&&s!=i&&s!=r||t(o,s)||this.addDoor(o,s);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let n=this._x1-1,i=this._x2+1,r=this._y1-1,o=this._y2+1;for(let s=n;s<=i;s++)for(let l=r;l<=o;l++)if(s==n||s==i||l==r||l==o){if(!t(s,l))return!1}else if(!e(s,l))return!1;return!0}create(t){let e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1,o=0;for(let s=e;s<=n;s++)for(let l=i;l<=r;l++)o=s+","+l in this._doors?2:s==e||s==n||l==i||l==r?1:0,t(s,l,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class Ye extends Xe{constructor(t,e,n,i){super(),this._startX=t,this._startY=e,this._endX=n,this._endY=i,this._endsWithAWall=!0}static createRandomAt(t,e,n,i,r){let o=r.corridorLength[0],s=r.corridorLength[1],l=ye.getUniformInt(o,s);return new this(t,e,t+n*l,e+i*l)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let n=this._startX,i=this._startY,r=this._endX-n,o=this._endY-i,s=1+Math.max(Math.abs(r),Math.abs(o));r&&(r/=Math.abs(r)),o&&(o/=Math.abs(o));let l=o,a=-r,c=!0;for(let h=0;h<s;h++){let u=n+h*r,f=i+h*o;if(e(u,f)||(c=!1),t(u+l,f+a)||(c=!1),t(u-l,f-a)||(c=!1),!c){s=h,this._endX=u-r,this._endY=f-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+r,this._endY+o))return!1;let h=!t(this._endX+r+l,this._endY+o+a),u=!t(this._endX+r-l,this._endY+o-a);return this._endsWithAWall=t(this._endX+r,this._endY+o),!h&&!u||!this._endsWithAWall}create(t){let e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n,o=1+Math.max(Math.abs(i),Math.abs(r));i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));for(let s=0;s<o;s++){t(e+s*i,n+s*r,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n;i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));let o=r,s=-i;t(this._endX+i,this._endY+r),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}}const Ve={room:He,corridor:Ye};function Ge(t,e,n){n[e[t+1]]=n[t],e[n[t]]=e[t+1],n[t]=t+1,e[t+1]=t}function qe(t,e,n){n[e[t]]=n[t],e[n[t]]=e[t],n[t]=t,e[t]=t}const Ke={Arena:class extends Be{create(t){let e=this._width-1,n=this._height-1;for(let i=0;i<=e;i++)for(let r=0;r<=n;r++){t(i,r,i&&r&&i<e&&r<n?0:1)}return this}},Uniform:class extends ze{constructor(t,e,n){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,n),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this}_generateRooms(){let t,e=this._width-2,n=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*n)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=He.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=ye.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=ye.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let n=this._closestRoom(this._connected,e);if(!n)break;if(!this._connectRooms(e,n))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let n=1/0,i=e.getCenter(),r=null;for(let e=0;e<t.length;e++){let o=t[e],s=o.getCenter(),l=s[0]-i[0],a=s[1]-i[1],c=l*l+a*a;c<n&&(n=c,r=o)}return r}_connectRooms(t,e){let n,i,r,o,s,l,a,c=t.getCenter(),h=e.getCenter(),u=h[0]-c[0],f=h[1]-c[1];if(Math.abs(u)<Math.abs(f)?(r=f>0?2:0,o=(r+2)%4,s=e.getLeft(),l=e.getRight(),a=0):(r=u>0?1:3,o=(r+2)%4,s=e.getTop(),l=e.getBottom(),a=1),n=this._placeInWall(t,r),!n)return!1;if(n[a]>=s&&n[a]<=l){i=n.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}i[(a+1)%2]=t,this._digLine([n,i])}else if(n[a]<s-1||n[a]>l+1){let t=n[a]-h[a],r=0;switch(o){case 0:case 1:r=t<0?3:1;break;case 2:case 3:r=t<0?1:3}if(o=(o+r)%4,i=this._placeInWall(e,o),!i)return!1;let s=[0,0];s[a]=n[a];let l=(a+1)%2;s[l]=i[l],this._digLine([n,s,i])}else{let t=(a+1)%2;if(i=this._placeInWall(e,o),!i)return!1;let r=Math.round((i[t]+n[t])/2),s=[0,0],l=[0,0];s[a]=n[a],s[t]=r,l[a]=i[a],l[t]=r,this._digLine([n,s,l,i])}return t.addDoor(n[0],n[1]),e.addDoor(i[0],i[1]),a=this._unconnected.indexOf(t),-1!=a&&(this._unconnected.splice(a,1),this._connected.push(t)),a=this._unconnected.indexOf(e),-1!=a&&(this._unconnected.splice(a,1),this._connected.push(e)),!0}_placeInWall(t,e){let n=[0,0],i=[0,0],r=0;switch(e){case 0:i=[1,0],n=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:i=[0,1],n=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:i=[1,0],n=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:i=[0,1],n=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1}let o=[],s=-2;for(let t=0;t<r;t++){let e=n[0]+t*i[0],r=n[1]+t*i[1];o.push(null),1==this._map[e][r]?s!=t-1&&(o[t]=[e,r]):(s=t,t&&(o[t-1]=null))}for(let t=o.length-1;t>=0;t--)o[t]||o.splice(t,1);return o.length?ye.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let n=t[e-1],i=t[e],r=new Ye(n[0],n[1],i[0],i[1]);r.create(this._digCallback),this._corridors.push(r)}}_digCallback(t,e,n){this._map[t][e]=n,0==n&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends Be{constructor(t,e,n={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(n),this._dirs=Le[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)this._map[e][n]=ye.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,n){this._map[t][e]=n}create(t){let e=this._fillMap(0),n=this._options.born,i=this._options.survive;for(let t=0;t<this._height;t++){let r=1,o=0;6==this._options.topology&&(r=2,o=t%2);for(let s=o;s<this._width;s+=r){let r=this._map[s][t],o=this._getNeighbors(s,t);r&&-1!=i.indexOf(o)?e[s][t]=1:r||-1==n.indexOf(o)||(e[s][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let n=1,i=0;6==this._options.topology&&(n=2,i=e%2);for(let r=i;r<this._width;r+=n)t(r,e,this._map[r][e])}}_getNeighbors(t,e){let n=0;for(let i=0;i<this._dirs.length;i++){let r=this._dirs[i],o=t+r[0],s=e+r[1];o<0||o>=this._width||s<0||s>=this._height||(n+=1==this._map[o][s]?1:0)}return n}connect(t,e,n){e||(e=0);let i=[],r={},o=1,s=[0,0];6==this._options.topology&&(o=2,s=[0,1]);for(let t=0;t<this._height;t++)for(let n=s[t%2];n<this._width;n+=o)if(this._freeSpace(n,t,e)){let e=[n,t];r[this._pointKey(e)]=e,i.push([n,t])}let l=i[ye.getUniformInt(0,i.length-1)],a=this._pointKey(l),c={};for(c[a]=l,delete r[a],this._findConnected(c,r,[l],!1,e);Object.keys(r).length>0;){let t=this._getFromTo(c,r),i=t[0],o=t[1],s={};s[this._pointKey(i)]=i,this._findConnected(s,r,[i],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,i,c,r,e,n);for(let t in s){let n=s[t];this._map[n[0]][n[1]]=e,c[t]=n,delete r[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let n,i=[0,0],r=[0,0],o=Object.keys(t),s=Object.keys(e);for(let l=0;l<5;l++){if(o.length<s.length){let n=o;r=t[n[ye.getUniformInt(0,n.length-1)]],i=this._getClosest(r,e)}else{let n=s;i=e[n[ye.getUniformInt(0,n.length-1)]],r=this._getClosest(i,t)}if(n=(i[0]-r[0])*(i[0]-r[0])+(i[1]-r[1])*(i[1]-r[1]),n<64)break}return[i,r]}_getClosest(t,e){let n=null,i=null;for(let r in e){let o=e[r],s=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==i||s<i)&&(i=s,n=o)}return n}_findConnected(t,e,n,i,r){for(;n.length>0;){let o,s=n.splice(0,1)[0];o=6==this._options.topology?[[s[0]+2,s[1]],[s[0]+1,s[1]-1],[s[0]-1,s[1]-1],[s[0]-2,s[1]],[s[0]-1,s[1]+1],[s[0]+1,s[1]+1]]:[[s[0]+1,s[1]],[s[0]-1,s[1]],[s[0],s[1]+1],[s[0],s[1]-1]];for(let s=0;s<o.length;s++){let l=this._pointKey(o[s]);null==t[l]&&this._freeSpace(o[s][0],o[s][1],r)&&(t[l]=o[s],i||delete e[l],n.push(o[s]))}}}_tunnelToConnected(t,e,n,i,r,o){let s,l;e[0]<t[0]?(s=e,l=t):(s=t,l=e);for(let t=s[0];t<=l[0];t++){this._map[t][s[1]]=r;let e=[t,s[1]],o=this._pointKey(e);n[o]=e,delete i[o]}o&&s[0]<l[0]&&o(s,[l[0],s[1]]);let a=l[0];e[1]<t[1]?(s=e,l=t):(s=t,l=e);for(let t=s[1];t<l[1];t++){this._map[a][t]=r;let e=[a,t],o=this._pointKey(e);n[o]=e,delete i[o]}o&&s[1]<l[1]&&o([l[0],s[1]],[l[0],l[1]])}_tunnelToConnected6(t,e,n,i,r,o){let s,l;e[0]<t[0]?(s=e,l=t):(s=t,l=e);let a=s[0],c=s[1];for(;a!=l[0]||c!=l[1];){let t=2;c<l[1]?(c++,t=1):c>l[1]&&(c--,t=1),a<l[0]?a+=t:a>l[0]||l[1]%2?a-=t:a+=t,this._map[a][c]=r;let e=[a,c],o=this._pointKey(e);n[o]=e,delete i[o]}o&&o(e,t)}_freeSpace(t,e,n){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==n}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends ze{constructor(t,e,n={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let n,i=Date.now();do{if(n=0,Date.now()-i>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),r=parseInt(e[0]),o=parseInt(e[1]),s=this._getDiggingDirection(r,o);if(!s)continue;let l=0;do{if(l++,this._tryFeature(r,o,s[0],s[1])){this._removeSurroundingWalls(r,o),this._removeSurroundingWalls(r-s[0],o-s[1]);break}}while(l<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&n++}while(this._dug/e<this._options.dugPercentage||n);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this._walls={},this._map=[],this}_digCallback(t,e,n){0==n||2==n?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),n=He.createRandomCenter(t,e,this._options);this._rooms.push(n),n.create(this._digCallback)}_findWall(){let t=[],e=[];for(let n in this._walls){2==this._walls[n]?e.push(n):t.push(n)}let n=e.length?e:t;if(!n.length)return null;let i=ye.getItem(n.sort());return delete this._walls[i],i}_tryFeature(t,e,n,i){let r=ye.getWeightedValue(this._features),o=Ve[r].createRandomAt(t,e,n,i,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof He&&this._rooms.push(o),o instanceof Ye&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(t,e){let n=Le[4];for(let i=0;i<n.length;i++){let r=n[i],o=t+r[0],s=e+r[1];delete this._walls[o+","+s],o=t+2*r[0],s=e+2*r[1],delete this._walls[o+","+s]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let n=null,i=Le[4];for(let r=0;r<i.length;r++){let o=i[r],s=t+o[0],l=e+o[1];if(!this._map[s][l]){if(n)return null;n=o}}return n?[-n[0],-n[1]]:null}_addDoors(){let t=this._map;function e(e,n){return 1==t[e][n]}for(let t=0;t<this._rooms.length;t++){let n=this._rooms[t];n.clearDoors(),n.addDoors(e)}}},EllerMaze:class extends Be{create(t){let e,n=this._fillMap(1),i=Math.ceil((this._width-2)/2),r=9/24,o=[],s=[];for(let t=0;t<i;t++)o.push(t),s.push(t);for(o.push(i-1),e=1;e+3<this._height;e+=2)for(let t=0;t<i;t++){let i=2*t+1,l=e;n[i][l]=0,t!=o[t+1]&&ye.getUniform()>r&&(Ge(t,o,s),n[i+1][l]=0),t!=o[t]&&ye.getUniform()>r?qe(t,o,s):n[i][l+1]=0}for(let t=0;t<i;t++){let i=2*t+1,l=e;n[i][l]=0,t!=o[t+1]&&(t==o[t]||ye.getUniform()>r)&&(Ge(t,o,s),n[i+1][l]=0),qe(t,o,s)}for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,n[e][i]);return this}},DividedMaze:class extends Be{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,n=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let i=0;i<n;i++){let r=0==t||0==i||t+1==e||i+1==n;this._map[t].push(r?1:0)}}this._stack=[[1,1,e-2,n-2]],this._process();for(let i=0;i<e;i++)for(let e=0;e<n;e++)t(i,e,this._map[i][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],n=[];for(let n=t[0]+1;n<t[2];n++){let i=this._map[n][t[1]-1],r=this._map[n][t[3]+1];!i||!r||n%2||e.push(n)}for(let e=t[1]+1;e<t[3];e++){let i=this._map[t[0]-1][e],r=this._map[t[2]+1][e];!i||!r||e%2||n.push(e)}if(!e.length||!n.length)return;let i=ye.getItem(e),r=ye.getItem(n);this._map[i][r]=1;let o=[],s=[];o.push(s);for(let e=t[0];e<i;e++)this._map[e][r]=1,e%2&&s.push([e,r]);s=[],o.push(s);for(let e=i+1;e<=t[2];e++)this._map[e][r]=1,e%2&&s.push([e,r]);s=[],o.push(s);for(let e=t[1];e<r;e++)this._map[i][e]=1,e%2&&s.push([i,e]);s=[],o.push(s);for(let e=r+1;e<=t[3];e++)this._map[i][e]=1,e%2&&s.push([i,e]);let l=ye.getItem(o);for(let t=0;t<o.length;t++){let e=o[t];if(e==l)continue;let n=ye.getItem(e);this._map[n[0]][n[1]]=0}this._stack.push([t[0],t[1],i-1,r-1]),this._stack.push([i+1,t[1],t[2],r-1]),this._stack.push([t[0],r+1,i-1,t[3]]),this._stack.push([i+1,r+1,t[2],t[3]])}},IceyMaze:class extends Be{constructor(t,e,n=0){super(t,e),this._regularity=n,this._map=[]}create(t){let e=this._width,n=this._height,i=this._fillMap(1);e-=e%2?1:2,n-=n%2?1:2;let r=0,o=0,s=0,l=0,a=0,c=!1,h=[[0,0],[0,0],[0,0],[0,0]];do{if(r=1+2*Math.floor(ye.getUniform()*(e-1)/2),o=1+2*Math.floor(ye.getUniform()*(n-1)/2),a||(i[r][o]=0),!i[r][o]){this._randomize(h);do{0==Math.floor(ye.getUniform()*(this._regularity+1))&&this._randomize(h),c=!0;for(let t=0;t<4;t++)if(s=r+2*h[t][0],l=o+2*h[t][1],this._isFree(i,s,l,e,n)){i[s][l]=0,i[r+h[t][0]][o+h[t][1]]=0,r=s,o=l,c=!1,a++;break}}while(!c)}}while(a+1<e*n/4);for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,i[e][n]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*ye.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,n,i,r){return!(e<1||n<1||e>=i||n>=r)&&t[e][n]}},Rogue:class extends Be{constructor(t,e,n){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(n=Object.assign({cellWidth:3,cellHeight:3},n)).hasOwnProperty("roomWidth")||(n.roomWidth=this._calculateRoomSize(this._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=this._calculateRoomSize(this._height,n.cellHeight)),this._options=n}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this.map[e][n]);return this}_calculateRoomSize(t,e){let n=Math.floor(t/e*.8),i=Math.floor(t/e*.25);return i<2&&(i=2),n<2&&(n=2),[i,n]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,n,i,r,o,s=ye.getUniformInt(0,this._options.cellWidth-1),l=ye.getUniformInt(0,this._options.cellHeight-1),a=!1;do{o=[0,2,4,6],o=ye.shuffle(o);do{if(a=!1,t=o.pop(),e=s+Le[8][t][0],n=l+Le[8][t][1],!(e<0||e>=this._options.cellWidth||n<0||n>=this._options.cellHeight)){if(i=this.rooms[s][l],i.connections.length>0&&i.connections[0][0]==e&&i.connections[0][1]==n)break;r=this.rooms[e][n],0==r.connections.length&&(r.connections.push([s,l]),this.connectedCells.push([e,n]),s=e,l=n,a=!0)}}while(o.length>0&&0==a)}while(o.length>0)}_connectUnconnectedRooms(){let t,e,n,i=this._options.cellWidth,r=this._options.cellHeight;this.connectedCells=ye.shuffle(this.connectedCells);for(let o=0;o<this._options.cellWidth;o++)for(let s=0;s<this._options.cellHeight;s++)if(t=this.rooms[o][s],0==t.connections.length){let l=[0,2,4,6];l=ye.shuffle(l),n=!1;do{let t=l.pop(),a=o+Le[8][t][0],c=s+Le[8][t][1];if(!(a<0||a>=i||c<0||c>=r)){if(e=this.rooms[a][c],n=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==o&&e.connections[t][1]==s){n=!1;break}if(n)break}}while(l.length);n?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,n,i,r,o=this._width,s=this._height,l=this._options.cellWidth,a=this._options.cellHeight,c=Math.floor(this._width/l),h=Math.floor(this._height/a),u=this._options.roomWidth,f=this._options.roomHeight;for(let p=0;p<l;p++)for(let l=0;l<a;l++){if(n=c*p,i=h*l,0==n&&(n=1),0==i&&(i=1),t=ye.getUniformInt(u[0],u[1]),e=ye.getUniformInt(f[0],f[1]),l>0)for(r=this.rooms[p][l-1];i-(r.y+r.height)<3;)i++;if(p>0)for(r=this.rooms[p-1][l];n-(r.x+r.width)<3;)n++;let a=Math.round(ye.getUniformInt(0,c-t)/2),d=Math.round(ye.getUniformInt(0,h-e)/2);for(;n+a+t>=o;)a?a--:t--;for(;i+d+e>=s;)d?d--:e--;n+=a,i+=d,this.rooms[p][l].x=n,this.rooms[p][l].y=i,this.rooms[p][l].width=t,this.rooms[p][l].height=e;for(let r=n;r<n+t;r++)for(let t=i;t<i+e;t++)this.map[r][t]=0}}_getWallPosition(t,e){let n,i,r;return 1==e||3==e?(n=ye.getUniformInt(t.x+1,t.x+t.width-2),1==e?(i=t.y-2,r=i+1):(i=t.y+t.height+1,r=i-1),this.map[n][r]=0):(i=ye.getUniformInt(t.y+1,t.y+t.height-2),2==e?(n=t.x+t.width+1,r=n-1):(n=t.x-2,r=n+1),this.map[r][i]=0),[n,i]}_drawCorridor(t,e){let n,i,r,o,s=e[0]-t[0],l=e[1]-t[1],a=t[0],c=t[1],h=[],u=Math.abs(s),f=Math.abs(l),p=ye.getUniform(),d=p,g=1-p;for(i=s>0?2:6,r=l>0?4:0,u<f?(n=Math.ceil(f*d),h.push([r,n]),h.push([i,u]),n=Math.floor(f*g),h.push([r,n])):(n=Math.ceil(u*d),h.push([i,n]),h.push([r,f]),n=Math.floor(u*g),h.push([i,n])),this.map[a][c]=0;h.length>0;)for(o=h.pop();o[1]>0;)a+=Le[8][o[0]][0],c+=Le[8][o[0]][1],this.map[a][c]=0,o[1]=o[1]-1}_createCorridors(){let t,e,n,i,r,o=this._options.cellWidth,s=this._options.cellHeight;for(let l=0;l<o;l++)for(let o=0;o<s;o++){t=this.rooms[l][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],n=this.rooms[e[0]][e[1]],n.cellx>t.cellx?(i=2,r=4):n.cellx<t.cellx?(i=4,r=2):n.celly>t.celly?(i=3,r=1):(i=1,r=3),this._drawCorridor(this._getWallPosition(t,i),this._getWallPosition(n,r))}}}};Math.sqrt(3),Math.sqrt(3);var Ze=[];new Ke.Cellular(30,30).randomize(.2).create((function(t,e,n){Ze[e]||(Ze[e]=[]),Ze[e][t]=n})),new Ke.Arena(30,30).create((function(t,e,n){Ze[e]||(Ze[e]=[]),Ze[e][t]=n||Ze[e][t]}));const Je={levelMap:Ze};var Qe=n(198),tn=n.n(Qe),en=(n(960),n(713)),nn=n(350),rn=n(934),on=n(653),sn=n(835),ln=n(312),an=n(773);function cn(t){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function un(t,e){return(un=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=dn(t);if(e){var r=dn(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return pn(this,n)}}function pn(t,e){return!e||"object"!==cn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function dn(t){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const gn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&un(t,e)}(o,t);var e,n,i,r=fn(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),e=r.call(this,t);var n=+new Date;return e.state={frames:0,startTime:n,prevTime:n,fps:-1},e}return e=o,(n=[{key:"shouldComponentUpdate",value:function(t,e){return this.state.fps!==e.fps||this.props!==t}},{key:"componentDidMount",value:function(){var t=this;this.afRequest=window.requestAnimationFrame((function e(){t.calcFPS(),t.afRequest=window.requestAnimationFrame(e)}))}},{key:"componentWillUnmount",value:function(){window.cancelAnimationFrame(this.afRequest)}},{key:"calcFPS",value:function(){var t=+new Date;if(this.setState((function(t){return{frames:t.frames+1}})),t>this.state.prevTime+1e3){var e=Math.round(1e3*this.state.frames/(t-this.state.prevTime));this.setState({fps:e,frames:0,prevTime:t})}}},{key:"render",value:function(){return qt("div",{id:"fps"},"FPS: "+this.state.fps)}}])&&hn(e.prototype,n),i&&hn(e,i),o}(Xt);function mn(t){return(mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vn(t,e){return(vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=wn(t);if(e){var r=wn(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return bn(this,n)}}function bn(t,e){return!e||"object"!==mn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function wn(t){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var xn=function(t,e,n){return(t.x-n.x)*(e.y-n.y)-(e.x-n.x)*(t.y-n.y)},kn={fudge:5,width:100,height:100,knownMap:[],lightSource:{x:0,y:0},markers:[],menuOpen:!1,mouseX:0,mouseY:0,preloadedMap:[],visibility:[],visibleMap:[],camerarays:!0,cameraLightsIntersectionPolygon:!0};const Sn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}(o,t);var e,n,i,r=yn(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,t)).state=kn,e}return e=o,(n=[{key:"componentDidMount",value:function(){this.resetMapDungeon()}},{key:"resetMapDungeon",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.width,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.height,n=[],i=[];new Ke.Arena(t,e).create((function(t,e,i){i&&(n[e]||(n[e]=[]),n[e][t]=i)})),new Ke.Cellular(t,e).randomize(.3).create((function(t,e,i){i&&(n[e]||(n[e]=[]),n[e][t]=i)}));var r=[];n.map((function(t,e){r[e]||(r[e]=[]),t.map((function(t,i){1===t&&(r[e][i]={},(e-1<0||1!=n[e-1][i])&&(r[e][i].north=!0),(e+1>n.length-1||1!=n[e+1][i])&&(r[e][i].south=!0),(i-1<0||1!=n[e][i-1])&&(r[e][i].west=!0),(i+1>n[0].length-1||1!=n[e][i+1])&&(r[e][i].east=!0))}))})),r.map((function(t,e){t.map((function(t,n){var r={x:n,y:e,wallType:"foo"};t.north&&i.push(new nn.Segment(n,e,n+1,e,r)),t.south&&i.push(new nn.Segment(n,e+1,n+1,e+1,r)),t.west&&i.push(new nn.Segment(n,e,n,e+1,r)),t.east&&i.push(new nn.Segment(n+1,e,n+1,e+1,r))}))}));var o=tn().segments({regions:i.map((function(t){return[[t.p1.x,t.p1.y],[t.p2.x,t.p2.y]]}))}),s=tn().polygon(o),l=(0,on.preLoadMap)(new en.A(0,0,0,0,{x:0,y:0,wallType:"idk"}),[],s);this.setState({preloadedMap:l})}},{key:"onMouseMove",value:function(t){this.setState({mouseX:t.clientX/this.state.fudge,mouseY:t.clientY/this.state.fudge})}},{key:"placeMarker",value:function(t){this.setState({markers:this.state.markers.concat({x:t.clientX/this.state.fudge,y:t.clientY/this.state.fudge})})}},{key:"isInTriangle",value:function(t,e,n){return i=t,r=n,o=e.first,s=e.second,l=xn(i,r,o),a=xn(i,o,s),c=xn(i,s,r),!((l<0||a<0||c<0)&&(l>0||a>0||c>0));var i,r,o,s,l,a,c}},{key:"knownMapCellFillAndStroke",value:function(t){var e={};return"foo"===t.type?e.fill="darkgrey":"floor"===t.type?e.fill="lightgrey":e.fill="black",t.visible?e.stroke="white":e.stroke="transparent",e}},{key:"render",value:function(){var t,e,n,i=this,r=this.state.fudge,o=(0,an.nZ)(this.state),s=new rn.Lightsource(new rn.Point(this.state.mouseX,this.state.mouseY),10),l=(0,sn.calculateVisibility)(s,(0,on.loadMap)(this.state.preloadedMap,s.position)),a=l.reduce((function(t,e){return t.concat(i.state.markers.filter((function(t){return i.isInTriangle(t,e,s.position)})))}),[]),c=o.markers,h=o.union,u=(0,ln.default)(l),f=c.map((function(t){return t.polygon}));if(l.length&&c.length){var p=tn().segments(u).segments;e=tn().combine({segments:h},{segments:p}),t=tn().selectIntersect(e),n=tn().polygon(t)}return qt("div",{},[qt("button",{id:"menuOpenButton",onClick:function(t){return i.setState({menuOpen:!0})}},"menu"),qt(gn,{}),qt("div",{id:"myNav",className:"overlay",style:this.state.menuOpen?{width:"100%"}:{width:"0%"}},[qt("div",{className:"overlay-content"},[qt("button",{className:"closebtn",onClick:function(t){return i.setState({menuOpen:!1})}},"close"),qt("h1",null,"Duskers-like experiment #1"),qt("p",null,"Move the mouse to change the position of the camera. Click to place a light source."),qt("h2",null,"Settings"),qt("h3",null,"Walls"),qt("label",{for:"showWallSegments"},"Show walls"),qt("input",{type:"checkbox",value:"showWallSegments",name:"showWallSegments",checked:this.state.showWallSegments,onChange:function(t){return i.setState({showWallSegments:t.target.checked})}}),qt("h3",null,"Rays"),qt("label",{for:"lightrays"},"Lights"),qt("input",{type:"checkbox",value:"lightrays",name:"lightrays",checked:this.state.lightrays,onChange:function(t){return i.setState({lightrays:t.target.checked})}}),qt("br",{},""),qt("label",{for:"camerarays"},"Camera"),qt("input",{type:"checkbox",value:"camerarays",name:"camerarays",checked:this.state.camerarays,onChange:function(t){return i.setState({camerarays:t.target.checked})}}),qt("h3",null,"Polygons"),qt("label",{for:"showCameraPolygon"},"Camera"),qt("input",{type:"checkbox",value:"showCameraPolygon",name:"showCameraPolygon",checked:this.state.showCameraPolygon,onChange:function(t){return i.setState({showCameraPolygon:t.target.checked})}}),qt("br",{},""),qt("label",{for:"lightsPolygons"},"Lights"),qt("input",{type:"checkbox",value:"lightsPolygons",name:"lightsPolygons",checked:this.state.lightsPolygons,onChange:function(t){return i.setState({lightsPolygons:t.target.checked})}}),qt("br",{},""),qt("label",{for:"cameraLightsIntersectionPolygon"},"Camera-lights interesction"),qt("input",{type:"checkbox",value:"cameraLightsIntersectionPolygon",name:"cameraLightsIntersectionPolygon",checked:this.state.cameraLightsIntersectionPolygon,onChange:function(t){return i.setState({cameraLightsIntersectionPolygon:t.target.checked})}}),qt("h2",null,"Credits"),qt("a",{href:"https://github.com/andrienko/2d-visibility/tree/updated-versions"},"https://github.com/andrienko/2d-visibility/tree/updated-versions"),qt("a",{href:"https://www.redblobgames.com/articles/visibility/"},"https://www.redblobgames.com/articles/visibility/"),qt("a",{href:"https://ondras.github.io/rot.js"},"https://ondras.github.io/rot.js"),qt("a",{href:"https://github.com/velipso/polybooljs"},"https://github.com/velipso/polybooljs")])]),qt("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",onMouseMove:function(t){return i.onMouseMove(t)},onClick:function(t){return i.placeMarker(t)}},[a.map((function(t){return qt("circle",{cx:t.x*r,cy:t.y*r,r:4,fill:"yellow",stroke:"black"})})),this.state.showWallSegments&&this.state.preloadedMap&&this.state.preloadedMap.map((function(t){return qt("g",{},[qt("line",{stroke:"red",x1:t.p1.x*r,y1:t.p1.y*r,x2:t.p2.x*r,y2:t.p2.y*r}),qt("circle",{stroke:"red",cx:t.p1.x*r,cy:t.p1.y*r,r:r/10}),qt("circle",{stroke:"red",cx:t.p2.x*r,cy:t.p2.y*r,r:r/10})])})),this.state.showCameraPolygon&&u&&u.regions&&u.regions.map((function(t){return qt("polygon",{fill:"blue",stroke:"black",points:t.reduce((function(t,e){return t.concat("".concat(e[0]*r,", ").concat(e[1]*r))}),[]).join(" ")})})),this.state.lightsPolygons&&f&&f.map((function(t){return t.regions.map((function(t){return qt("polygon",{fill:"yellow",stroke:"black",points:t.map((function(t){return"".concat(t[0]*r,", ").concat(t[1]*r)})).join(" ")})}))})),this.state.cameraLightsIntersectionPolygon&&n&&n.regions.map((function(t){return qt("polygon",{fill:"yellow",stroke:"blue",points:t.map((function(t){return"".concat(t[0]*r,", ").concat(t[1]*r)})).join(" ")})})),this.state.camerarays&&l.map((function(t){var e=t.first,n=t.second,i={x1:e.x*r,y1:e.y*r,x2:n.x*r,y2:n.y*r},o=s.position.x*r,l=s.position.y*r;return[qt("line",{x1:o,y1:l,x2:i.x1,y2:i.y1,stroke:"blue"}),qt("line",{x1:o,y1:l,x2:i.x2,y2:i.y2,stroke:"blue"})]})),this.state.lightrays&&c.map((function(t){return t.triangles.map((function(e){return[qt("line",{x1:t.x*r,y1:t.y*r,x2:e.first.x*r,y2:e.first.y*r,stroke:"yellow"})," ",qt("line",{x1:t.x*r,y1:t.y*r,x2:e.second.x*r,y2:e.second.y*r,stroke:"yellow"})]}))})),qt("circle",{cx:s.position.x*r,cy:s.position.y*r,r:4,fill:"blue",stroke:"black"})])])}}])&&_n(e.prototype,n),i&&_n(e,i),o}(Xt);var Cn=function(t){return te((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;switch(e.type){case he:return ge(ge({},t),{},{INITAILIZED:!0});case ae:return ge(ge({},t),{},{sandwiches:t.sandwiches.filter((function(t,n){return n!==e.payload}))});case ne:return ge(ge({},t),{},{gratuity:Math.max(e.payload,0)});case ce:return ge(ge({},t),{},{sandwiches:t.sandwiches.map((function(t){return t.name===e.payload.sandwichName&&(t.toPush=e.payload.ingredientId),t}))});case le:return ge(ge({},t),{},{sandwiches:t.sandwiches.map((function(t,n){return n===e.payload&&(t.recipe.push(t.toPush),t.toPush=""),t}))});case se:return ge(ge({},t),{},{sandwiches:t.sandwiches.map((function(t){return t.name===e.payload&&t.recipe.pop(),t}))});case ie:return ge(ge({},t),{},{sandwiches:t.sandwiches.map((function(t,n){return n===e.payload.index&&(t.name=e.payload.sandwichName),t}))});case ee:return ge(ge({},t),{},{stagedSandwich:"",sandwiches:[].concat(fe(t.sandwiches),[{name:t.stagedSandwich,recipe:[],toPush:""}])});case re:return ge(ge({},t),{},{stagedSandwich:e.payload});case oe:var n=Object.keys(t.orders);return ge(ge({},t),{},{sandwiches:[],orders:ge(ge({},t.orders),{},me({},Math.max.apply(Math,fe(n.length?n.map((function(t){return parseInt(t)})):[0]))+1,{grandTotal:e.payload,status:"open",sandwiches:t.sandwiches.map((function(t){return{name:t.name,recipe:t.recipe}}))})),ingredients:t.ingredients.map((function(e){return t.sandwiches.forEach((function(t){t.recipe.forEach((function(t){t===e.id&&(e.amount=e.amount-1)}))})),e}))});case ue:var i={};return Object.keys(t.orders).forEach((function(n){i[n]=t.orders[n],n===e.payload&&(i[n].status="closed")})),ge(ge({},t),{},{orders:i});default:return t}}),t)}(Je);document.addEventListener("DOMContentLoaded",(function(t){var e=document.getElementById("root");Cn.subscribe((function(){e&&Wt(qt(Sn,{storeState:Cn.getState()},""),e)})),Cn.dispatch({type:"INITIALIZE"})}))})()})();